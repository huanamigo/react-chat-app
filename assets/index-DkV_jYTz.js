import{j as e,r,a as H}from"./react-BrP7bTIu.js";import{c as z}from"./react-dom-BtizlmEl.js";import{i as K,g as Q,a as G,b as V,o as Y,c as P,u as O,d as D,e as w,f as T,T as E,h as m,j as W,k as J,s as U,l as $,q as X,w as ee,m as se,n as te,p as ne,t as ae,v as oe,x as re}from"./@firebase-BX6E7TT8.js";import"./firebase-DCOarsU4.js";import{v as b}from"./uuid-D8aEg3BZ.js";import{d as R,e as ie,f as ce,g as I}from"./react-router-C0nYgrbg.js";import{N as k,H as le}from"./react-router-dom-iW47g7mf.js";import"./scheduler-CzFDRTuY.js";import"./tslib-BGVaTf34.js";import"./idb-BXWtuYvb.js";import"./@remix-run-BgBg4VcQ.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))l(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const d of n.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&l(d)}).observe(document,{childList:!0,subtree:!0});function i(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function l(s){if(s.ep)return;s.ep=!0;const n=i(s);fetch(s.href,n)}})();const de="_container_11yjs_2",ue={container:de},pe="_container_1g0o2_1",he="_topbar_1g0o2_9",me="_messageWrapper_1g0o2_25",C={container:pe,topbar:he,messageWrapper:me},ge="_container_tsfc4_1",xe="_time_tsfc4_13",q={container:ge,time:xe},fe=({messageText:t,time:a})=>e.jsxs("div",{className:q.container,children:[e.jsx("p",{children:t}),e.jsx("span",{className:q.time,children:a})]}),je="_container_1yh78_1",_e="_inputWrapper_1yh78_6",ye="_fileInputLabel_1yh78_22",ve="_textInput_1yh78_30",we="_sendBtn_1yh78_35",y={container:je,inputWrapper:_e,fileInputLabel:ye,textInput:ve,sendBtn:we},Ne={apiKey:"AIzaSyAB80-tZTx63iK-eSokF2n1HNM25fO_rZ4",authDomain:"react-chat-app-cf377.firebaseapp.com",projectId:"react-chat-app-cf377",storageBucket:"react-chat-app-cf377.appspot.com",messagingSenderId:"333727045415",appId:"1:333727045415:web:07aac7a056b70e402bbb02"};K(Ne);const N=Q(),F=G(),h=V(),j=r.createContext({currentUser:{},isLoading:!0,setIsLoading:t=>{}}),Se=({children:t})=>{const[a,i]=r.useState({}),[l,s]=r.useState(!0);r.useEffect(()=>{const d=Y(N,c=>{c&&i(c),s(!1)});return()=>{d()}},[a]);const n={currentUser:a,isLoading:l,setIsLoading:s};return e.jsx(j.Provider,{value:n,children:t})},S=r.createContext({}),be=({children:t})=>{const a={chatId:"",user:{}},{currentUser:i}=r.useContext(j),l=(d,c)=>{if(c.type==="CHANGE_USER"){if(console.log(c.payload),i.uid)return{user:c.payload,chatId:i.uid>c.payload.uid?i.uid+c.payload.uid:c.payload.uid+i.uid}}else return d},[s,n]=r.useReducer(l,a);return e.jsx(S.Provider,{value:{data:s,dispatch:n},children:t})},Ie=()=>{const[t,a]=r.useState(""),[i,l]=r.useState(),{data:s}=r.useContext(S),{currentUser:n}=r.useContext(j),d=async()=>{if(console.log(i),i){const c=P(F,b()),u=O(c,i);u.on("state_changed",p=>{const o=p.bytesTransferred/p.totalBytes*100;switch(console.log("Upload is "+o+"% done"),p.state){case"paused":console.log("Upload is paused");break;case"running":console.log("Upload is running");break}},p=>{console.log(String(p))},()=>{D(u.snapshot.ref).then(async p=>{s!=null&&s.chatId&&await w(m(h,"chats",s==null?void 0:s.chatId),{messages:T({id:b(),text:t,senderId:n.uid,date:E.now(),img:p})})})}),console.log(t)}else console.log(s==null?void 0:s.chatId),s!=null&&s.chatId&&await w(m(h,"chats",s==null?void 0:s.chatId),{messages:T({id:b(),text:t,senderId:n.uid,date:E.now()})})};return e.jsxs("div",{className:y.container,children:[e.jsxs("div",{className:y.inputWrapper,children:[e.jsx("label",{htmlFor:"fileInput",className:y.fileInputLabel,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#fff",children:e.jsx("path",{d:"M640-520v-200h80v200h-80ZM440-244q-35-10-57.5-39T360-350v-370h80v476Zm30 164q-104 0-177-73t-73-177v-370q0-75 52.5-127.5T400-880q75 0 127.5 52.5T580-700v300h-80v-300q-1-42-29.5-71T400-800q-42 0-71 29t-29 71v370q-1 71 49 120.5T470-160q25 0 47.5-6.5T560-186v89q-21 8-43.5 12.5T470-80Zm170-40v-120H520v-80h120v-120h80v120h120v80H720v120h-80Z"})})}),e.jsx("input",{className:y.textInput,onChange:c=>a(c.target.value)}),e.jsx("input",{type:"file",id:"fileInput",onChange:c=>{c.target.files&&l(c.target.files[0])}})]}),e.jsx("button",{className:y.sendBtn,onClick:d,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#fff",children:e.jsx("path",{d:"M120-160v-640l760 320-760 320Zm80-120 474-200-474-200v140l240 60-240 60v140Zm0 0v-400 400Z"})})})]})},Ce=()=>{const{data:t}=r.useContext(S),[a,i]=r.useState([]);return r.useEffect(()=>{if(t!=null&&t.chatId){const l=W(m(h,"chats",t.chatId),s=>{s.exists()&&i(s.data().messages),console.log(s.data())});return()=>{l()}}},[t==null?void 0:t.chatId]),e.jsx("div",{className:C.container,children:(t==null?void 0:t.chatId)!==""?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:C.topbar,children:t!=null&&t.user?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:t.user.photoURL,alt:"User photo",onClick:()=>console.log(t.user)}),e.jsx("p",{children:t.user.displayName})]}):e.jsx("p",{children:"USER NOT FOUND"})}),e.jsxs("div",{className:C.messageWrapper,children:[a.length<0&&a.map(l=>e.jsx(fe,{messageText:l,time:"15:40"})),e.jsx(Ie,{})]})]}):null})},Le="_container_t6ds5_1",Ue="_wrapper_t6ds5_14",Re="_username_t6ds5_20",Te="_message_t6ds5_23",f={container:Le,wrapper:Ue,username:Re,message:Te},B=({chatUser:t,setSearchedUser:a,isSearched:i,setUserQuery:l})=>{const{currentUser:s}=r.useContext(j),{dispatch:n}=r.useContext(S),[d,c]=r.useState({});r.useEffect(()=>{if(s!=null&&s.uid){const o=W(m(h,"userChats",s.uid),g=>{const _=g.data();_!==void 0&&c(_)});return()=>{o()}}},[s.uid]);const u=async()=>{if(s.uid!==""&&s.uid!==void 0){const o=s.uid>t.uid?s.uid+t.uid:t.uid+s.uid;try{const g=await J(m(h,"chats",o));g.exists()||(await U(m(h,"chats",o),{messages:[]}),await w(m(h,"userChats",s.uid),{[o+".userInfo"]:{uid:t.uid,displayName:t.displayName,photoURL:t.photoURL},[o+".date"]:$()}),await w(m(h,"userChats",t.uid),{[o+".userInfo"]:{uid:s.uid,displayName:s.displayName,photoURL:s.photoURL},[o+".date"]:$()})),i&&(a({displayName:"",photoURL:"",lastMessage:"",uid:""}),l("")),console.log(g)}catch(g){console.log(g)}}console.log(s.uid+t.uid)},p=o=>{n({type:"CHANGE_USER",payload:o})};return e.jsx(e.Fragment,{children:i?e.jsxs("div",{onClick:()=>{u(),p(t)},className:f.container,children:[e.jsx("img",{src:t.photoURL}),e.jsx("div",{className:f.wrapper,children:e.jsx("p",{className:f.username,children:t.displayName})})]}):e.jsx(e.Fragment,{children:Object.entries(d).map(o=>e.jsxs("div",{className:f.container,onClick:()=>p(o[1].userInfo),children:[e.jsx("img",{src:o[1].userInfo.photoURL}),e.jsxs("div",{className:f.wrapper,children:[e.jsx("p",{className:f.username,children:o[1].userInfo.displayName}),e.jsx("p",{className:f.message,children:o[1].userInfo.lastMessage})]})]},o[0]))})})},Ee="_container_17q7h_1",$e={container:Ee},qe=({setSearchedUser:t,userQuery:a,setUserQuery:i})=>{const[l,s]=r.useState(""),n=async d=>{const c=X(se(h,"users"),ee("email","==",d));try{const u=await te(c);console.log(u.docs.length),u.docs.length>0?u.forEach(p=>{const o=p.data();console.log(o),t({displayName:o.displayName,photoURL:o.photoURL,lastMessage:"???",uid:o.uid})}):t({displayName:"",photoURL:"",lastMessage:"",uid:""})}catch(u){s(String(u)),console.log(u)}};return e.jsxs("div",{className:$e.container,children:[e.jsx("input",{type:"text",placeholder:"Search email",onChange:d=>{i(d.target.value),n(d.target.value)},value:a}),l!==""&&e.jsx("p",{children:l})]})},Be="_container_z4dfh_1",Me="_navbar_z4dfh_5",Ae="_logoutBtn_z4dfh_12",L={container:Be,navbar:Me,logoutBtn:Ae},Pe=()=>{const t=R(),{currentUser:a}=r.useContext(j),[i,l]=r.useState({displayName:"",photoURL:"",uid:"",lastMessage:""}),[s,n]=r.useState(""),[d]=r.useState({displayName:"Temp User",photoURL:"https://source.unsplash.com/random",lastMessage:"Last message text",uid:"qwertyuioQWERTYUIO"});return e.jsxs("div",{className:L.container,children:[e.jsxs("div",{className:L.navbar,children:[e.jsx("img",{src:a==null?void 0:a.photoURL,alt:a.displayName}),e.jsx("span",{children:a.displayName}),e.jsx("button",{className:L.logoutBtn,onClick:()=>{ne(N).then(()=>{t("../login",{replace:!0})}).catch(c=>{console.log(c)})},children:"Logout"})]}),e.jsx(qe,{setSearchedUser:l,userQuery:s,setUserQuery:n}),i.displayName!==""&&e.jsx(B,{chatUser:i,setSearchedUser:l,isSearched:!0,setUserQuery:n}),e.jsx(B,{chatUser:d})]})},Oe="_container_1whll_1",De="_wrapper_1whll_5",We="_loadingScreen_1whll_9",ke="_loader_1whll_18",Fe="_rotation_1whll_1",v={container:Oe,wrapper:De,loadingScreen:We,loader:ke,rotation:Fe},Ze=()=>{const{currentUser:t,isLoading:a}=r.useContext(j);return a?e.jsx("div",{className:v.loadingScreen,children:e.jsx("span",{className:v.loader})}):"email"in t?e.jsx("div",{className:v.container,children:e.jsxs("div",{className:v.wrapper,children:[e.jsx(Pe,{}),e.jsx(Ce,{})]})}):e.jsx(ie,{to:{pathname:"/login"}})},He="_container_1y4t8_1",ze="_error_1y4t8_40",M={container:He,error:ze},Ke=()=>{const[t,a]=r.useState(""),i=R(),l=s=>{s.preventDefault();const n=s.currentTarget[0].value,d=s.currentTarget[1].value,c=s.currentTarget[2].value,u=s.currentTarget[4],p=u.files?u.files[0]:null;console.log(n);try{const o=ae(N,d,c),g=P(F,n);if(p){const _=O(g,p);_.on("state_changed",x=>{const Z=x.bytesTransferred/x.totalBytes*100;switch(console.log("Upload is "+Z+"% done"),x.state){case"paused":console.log("Upload is paused");break;case"running":console.log("Upload is running");break}},x=>{a(String(x))},()=>{D(_.snapshot.ref).then(async x=>{await oe((await o).user,{displayName:n,photoURL:x}),await U(m(h,"users",(await o).user.uid),{uid:(await o).user.uid,displayName:n,email:d,photoURL:x}),await U(m(h,"userChats",(await o).user.uid),{})}),i("../",{replace:!0})})}}catch(o){a(String(o)),console.log(o)}};return e.jsxs("div",{className:M.container,children:[e.jsxs("form",{onSubmit:s=>l(s),children:[e.jsx("input",{type:"text",autoComplete:"username",placeholder:"Username"}),e.jsx("input",{type:"email",autoComplete:"email",placeholder:"E-mail"}),e.jsx("input",{type:"password",autoComplete:"new-password",placeholder:"Password"}),e.jsx("input",{type:"password",autoComplete:"new-password",placeholder:"Confirm password"}),e.jsx("input",{type:"file"}),e.jsx("button",{children:"Sign Up"}),t!==""&&e.jsx("span",{className:M.error,children:"Something went wrong"})]}),e.jsxs("p",{children:["Already have an account? ",e.jsx(k,{to:"/login",children:"Log In"})]})]})},Qe="_container_1azqi_1",Ge="_error_1azqi_40",A={container:Qe,error:Ge},Ve=()=>{const[t,a]=r.useState(""),{setIsLoading:i}=r.useContext(j),l=R(),s=async n=>{n.preventDefault();const d=n.currentTarget[0].value,c=n.currentTarget[1].value;try{try{await re(N,d,c)}catch(u){throw a(String(u)),u}i(!0),l("../",{replace:!0})}catch(u){throw a(String(u)),u}};return e.jsxs("div",{className:A.container,children:[e.jsxs("form",{onSubmit:n=>s(n),children:[e.jsx("input",{type:"email",autoComplete:"email",placeholder:"E-mail"}),e.jsx("input",{type:"password",autoComplete:"current-password",placeholder:"Password"}),e.jsx("button",{children:"Login"}),t!==""&&e.jsxs("span",{className:A.error,children:["Something went wrong ",t]})]}),e.jsxs("p",{children:["Don't have an account? ",e.jsx(k,{to:"/register",children:"Sign Up"})]})]})};function Ye(){return e.jsx("div",{className:ue.container,children:e.jsxs(ce,{children:[e.jsx(I,{path:"/",element:e.jsx(Ze,{})}),e.jsx(I,{path:"/register",element:e.jsx(Ke,{})}),e.jsx(I,{path:"/login",element:e.jsx(Ve,{})})]})})}z.createRoot(document.getElementById("root")).render(e.jsx(H.StrictMode,{children:e.jsx(Se,{children:e.jsx(be,{children:e.jsx(le,{children:e.jsx(Ye,{})})})})}));
