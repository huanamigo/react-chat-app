import{j as e,r as i,a as M}from"./react-BrP7bTIu.js";import{c as P}from"./react-dom-BtizlmEl.js";import{i as D,g as O,a as B,b as q,o as z,c as F,d as x,e as k,s as S,u as C,f as L,q as H,w as K,h as Q,j as W,k as Z,l as V,m as Y,n as G,p as J,t as X,v as ee}from"./@firebase-BLQkDeAT.js";import"./firebase-EUiONGWj.js";import{d as N,e as se,f as te,g as w}from"./react-router-C0nYgrbg.js";import{N as E,H as ae}from"./react-router-dom-iW47g7mf.js";import"./scheduler-CzFDRTuY.js";import"./tslib-BGVaTf34.js";import"./idb-BXWtuYvb.js";import"./@remix-run-BgBg4VcQ.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))c(s);new MutationObserver(s=>{for(const t of s)if(t.type==="childList")for(const o of t.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&c(o)}).observe(document,{childList:!0,subtree:!0});function l(s){const t={};return s.integrity&&(t.integrity=s.integrity),s.referrerPolicy&&(t.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?t.credentials="include":s.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function c(s){if(s.ep)return;s.ep=!0;const t=l(s);fetch(s.href,t)}})();const re="_container_11yjs_2",ne={container:re},oe="_container_1e56t_1",ce={container:oe},ie="_container_tsfc4_1",le="_time_tsfc4_13",I={container:ie,time:le},f=({messageText:a,time:n})=>e.jsxs("div",{className:I.container,children:[e.jsx("p",{children:a}),e.jsx("span",{className:I.time,children:n})]}),ue="_container_f0tss_1",de={container:ue},pe=()=>e.jsx("div",{className:de.container,children:e.jsx("textarea",{})}),me=()=>e.jsxs("div",{className:ce.container,children:[e.jsx(f,{messageText:"11111 1111 1111 1111111 1 111",time:"15:40"}),e.jsx(f,{messageText:"22222222222222222222",time:"15:40"}),e.jsx(f,{messageText:"333333 3333333 3333333333 3333333 333",time:"15:40"}),e.jsx(f,{messageText:"444 44444 444 44444  44",time:"15:40"}),e.jsx(f,{messageText:"5555 5555555 5555 5555 555 5555",time:"15:40"}),e.jsx(f,{messageText:"55555555555555555555555555555555555555",time:"15:40"}),e.jsx(pe,{})]}),ge="_container_t6ds5_1",he="_wrapper_t6ds5_14",xe="_username_t6ds5_20",fe="_message_t6ds5_23",h={container:ge,wrapper:he,username:xe,message:fe},je={apiKey:"AIzaSyAB80-tZTx63iK-eSokF2n1HNM25fO_rZ4",authDomain:"react-chat-app-cf377.firebaseapp.com",projectId:"react-chat-app-cf377",storageBucket:"react-chat-app-cf377.appspot.com",messagingSenderId:"333727045415",appId:"1:333727045415:web:07aac7a056b70e402bbb02"};D(je);const y=O(),_e=B(),g=q(),j=i.createContext({currentUser:{},isLoading:!0,setIsLoading:a=>{}}),ye=({children:a})=>{const[n,l]=i.useState({}),[c,s]=i.useState(!0);i.useEffect(()=>{const o=z(y,d=>{d&&l(d),s(!1)});return()=>{o()}},[n]);const t={currentUser:n,isLoading:c,setIsLoading:s};return e.jsx(j.Provider,{value:t,children:a})},$=({chatUser:a,setSearchedUser:n,isSearched:l,setUserQuery:c})=>{const{currentUser:s}=i.useContext(j),[t,o]=i.useState({});i.useEffect(()=>{if(s!=null&&s.uid){const r=F(x(g,"userChats",s.uid),p=>{const u=p.data();u!==void 0&&o(u)});return()=>{r()}}},[s.uid]);const d=async()=>{if(s.uid!==""&&s.uid!==void 0){const r=s.uid>a.uid?s.uid+a.uid:a.uid+s.uid;try{const p=await k(x(g,"chats",r));p.exists()||(await S(x(g,"chats",r),{messages:[]}),await C(x(g,"userChats",s.uid),{[r+".userInfo"]:{uid:a.uid,displayName:a.username,photoURL:a.img},[r+".date"]:L()}),await C(x(g,"userChats",a.uid),{[r+".userInfo"]:{uid:s.uid,displayName:s.displayName,photoURL:s.photoURL},[r+".date"]:L()})),l&&(n({username:"",img:"",lastMessage:"",uid:""}),c("")),console.log(p)}catch(p){console.log(p)}}console.log(s.uid+a.uid)};return e.jsx(e.Fragment,{children:l?e.jsxs("div",{onClick:()=>d(),className:h.container,children:[e.jsx("img",{src:a.img}),e.jsx("div",{className:h.wrapper,children:e.jsx("p",{className:h.username,children:a.username})})]}):e.jsx(e.Fragment,{children:Object.entries(t).map(r=>e.jsxs("div",{className:h.container,children:[e.jsx("img",{src:r[1].userInfo.photoURL}),e.jsxs("div",{className:h.wrapper,children:[e.jsx("p",{className:h.username,children:r[1].userInfo.displayName}),e.jsx("p",{className:h.message,children:r[1].userInfo.lastMessage})]})]},r[0]))})})},we="_container_17q7h_1",ve={container:we},Se=({setSearchedUser:a,userQuery:n,setUserQuery:l})=>{const[c,s]=i.useState(""),t=async o=>{const d=H(Q(g,"users"),K("email","==",o));try{const r=await W(d);console.log(r.docs.length),r.docs.length>0?r.forEach(p=>{const u=p.data();console.log(u),a({username:u.displayName,img:u.photoURL,lastMessage:"???",uid:u.uid})}):a({username:"",img:"",lastMessage:"",uid:""})}catch(r){s(String(r)),console.log(r)}};return e.jsxs("div",{className:ve.container,children:[e.jsx("input",{type:"text",placeholder:"Search email",onChange:o=>{l(o.target.value),t(o.target.value)},value:n}),c!==""&&e.jsx("p",{children:c})]})},Ne="_container_1otf5_1",be="_navbar_1otf5_5",Ce="_logoutBtn_1otf5_11",v={container:Ne,navbar:be,logoutBtn:Ce},Le=()=>{const a=N(),{currentUser:n}=i.useContext(j),[l,c]=i.useState({username:"",img:"",lastMessage:"",uid:""}),[s,t]=i.useState(""),[o]=i.useState({username:"Temp User",img:"https://source.unsplash.com/random",lastMessage:"Last message text",uid:"qwertyuioQWERTYUIO"});return e.jsxs("div",{className:v.container,children:[e.jsxs("div",{className:v.navbar,children:[e.jsx("img",{src:n==null?void 0:n.photoURL,alt:n.displayName}),e.jsx("span",{children:n.displayName}),e.jsx("button",{className:v.logoutBtn,onClick:()=>{Z(y).then(()=>{a("../login",{replace:!0})}).catch(d=>{console.log(d)})},children:"Logout"})]}),e.jsx(Se,{setSearchedUser:c,userQuery:s,setUserQuery:t}),l.username!==""&&e.jsx($,{chatUser:l,setSearchedUser:c,isSearched:!0,setUserQuery:t}),e.jsx($,{chatUser:o})]})},Ie="_container_6zf3o_1",$e="_wrapper_6zf3o_5",Re="_loadingScreen_6zf3o_9",Te="_loader_6zf3o_18",Ee="_rotation_6zf3o_1",_={container:Ie,wrapper:$e,loadingScreen:Re,loader:Te,rotation:Ee},Ue=()=>{const{currentUser:a,isLoading:n}=i.useContext(j);return console.log(a),console.log(n),n?e.jsx("div",{className:_.loadingScreen,children:e.jsx("span",{className:_.loader})}):"email"in a?e.jsx("div",{className:_.container,children:e.jsxs("div",{className:_.wrapper,children:[e.jsx(Le,{}),e.jsx(me,{})]})}):e.jsx(se,{to:{pathname:"/login"}})},Ae="_container_pscem_1",Me="_error_pscem_40",R={container:Ae,error:Me},Pe=()=>{const[a,n]=i.useState(""),l=N(),c=s=>{s.preventDefault();const t=s.currentTarget[0].value,o=s.currentTarget[1].value,d=s.currentTarget[2].value,r=s.currentTarget[4],p=r.files?r.files[0]:null;console.log(t);try{const u=V(y,o,d),U=Y(_e,t);if(p){const b=G(U,p);b.on("state_changed",m=>{const A=m.bytesTransferred/m.totalBytes*100;switch(console.log("Upload is "+A+"% done"),m.state){case"paused":console.log("Upload is paused");break;case"running":console.log("Upload is running");break}},m=>{n(String(m))},()=>{J(b.snapshot.ref).then(async m=>{await X((await u).user,{displayName:t,photoURL:m}),await S(x(g,"users",(await u).user.uid),{uid:(await u).user.uid,displayName:t,email:o,photoURL:m}),await S(x(g,"userChats",(await u).user.uid),{})}),l("../",{replace:!0})})}}catch(u){n(String(u)),console.log(u)}};return e.jsxs("div",{className:R.container,children:[e.jsxs("form",{onSubmit:s=>c(s),children:[e.jsx("input",{type:"text",autoComplete:"username",placeholder:"Username"}),e.jsx("input",{type:"email",autoComplete:"email",placeholder:"E-mail"}),e.jsx("input",{type:"password",autoComplete:"new-password",placeholder:"Password"}),e.jsx("input",{type:"password",autoComplete:"new-password",placeholder:"Confirm password"}),e.jsx("input",{type:"file"}),e.jsx("button",{children:"Sign Up"}),a!==""&&e.jsx("span",{className:R.error,children:"Something went wrong"})]}),e.jsxs("p",{children:["Already have an account? ",e.jsx(E,{to:"/login",children:"Log In"})]})]})},De="_container_1j0f6_1",Oe="_error_1j0f6_40",T={container:De,error:Oe},Be=()=>{const[a,n]=i.useState(""),{setIsLoading:l}=i.useContext(j),c=N(),s=async t=>{t.preventDefault();const o=t.currentTarget[0].value,d=t.currentTarget[1].value;try{try{await ee(y,o,d)}catch(r){throw n(String(r)),r}l(!0),c("../",{replace:!0})}catch(r){throw n(String(r)),r}};return e.jsxs("div",{className:T.container,children:[e.jsxs("form",{onSubmit:t=>s(t),children:[e.jsx("input",{type:"email",autoComplete:"email",placeholder:"E-mail"}),e.jsx("input",{type:"password",autoComplete:"current-password",placeholder:"Password"}),e.jsx("button",{children:"Login"}),a!==""&&e.jsxs("span",{className:T.error,children:["Something went wrong ",a]})]}),e.jsxs("p",{children:["Don't have an account? ",e.jsx(E,{to:"/register",children:"Sign Up"})]})]})};function qe(){return e.jsx("div",{className:ne.container,children:e.jsxs(te,{children:[e.jsx(w,{path:"/",element:e.jsx(Ue,{})}),e.jsx(w,{path:"/register",element:e.jsx(Pe,{})}),e.jsx(w,{path:"/login",element:e.jsx(Be,{})})]})})}P.createRoot(document.getElementById("root")).render(e.jsx(M.StrictMode,{children:e.jsx(ye,{children:e.jsx(ae,{children:e.jsx(qe,{})})})}));
