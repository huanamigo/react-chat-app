import{r as c,j as s,a as H}from"./react-BrP7bTIu.js";import{c as K}from"./react-dom-BtizlmEl.js";import{i as Q,g as G,a as V,b as Y,o as J,c as P,u as D,d as F,e as _,f as E,T as q,h as x,s as N,j as W,k as X,l as T,q as ee,w as se,m as te,n as ne,p as oe,t as ae,v as re,x as ie}from"./@firebase-C2FYEwhL.js";import"./firebase-C9-PzAQB.js";import{v as L}from"./uuid-D8aEg3BZ.js";import{d as $,e as ce,f as le,g as U}from"./react-router-C0nYgrbg.js";import{N as k,H as de}from"./react-router-dom-iW47g7mf.js";import"./scheduler-CzFDRTuY.js";import"./tslib-BGVaTf34.js";import"./idb-BXWtuYvb.js";import"./@remix-run-BgBg4VcQ.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const d of n.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&r(d)}).observe(document,{childList:!0,subtree:!0});function i(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(e){if(e.ep)return;e.ep=!0;const n=i(e);fetch(e.href,n)}})();const ue="_container_11yjs_2",pe={container:ue},he="_container_ht8ob_1",ge="_topbar_ht8ob_9",me="_messageWrapper_ht8ob_25",M={container:he,topbar:ge,messageWrapper:me},xe="_ownMessage_a2fyp_1",fe="_notMyMessage_a2fyp_8",je="_container_a2fyp_15",_e="_time_a2fyp_23",w={ownMessage:xe,notMyMessage:fe,container:je,time:_e},ye={apiKey:"AIzaSyAB80-tZTx63iK-eSokF2n1HNM25fO_rZ4",authDomain:"react-chat-app-cf377.firebaseapp.com",projectId:"react-chat-app-cf377",storageBucket:"react-chat-app-cf377.appspot.com",messagingSenderId:"333727045415",appId:"1:333727045415:web:07aac7a056b70e402bbb02"};Q(ye);const C=G(),z=V(),g=Y(),y=c.createContext({currentUser:{},isLoading:!0,setIsLoading:t=>{}}),ve=({children:t})=>{const[a,i]=c.useState({}),[r,e]=c.useState(!0);c.useEffect(()=>{const d=J(C,l=>{l&&i(l),e(!1)});return()=>{d()}},[a]);const n={currentUser:a,isLoading:r,setIsLoading:e};return s.jsx(y.Provider,{value:n,children:t})},we=({messageText:t,time:a,senderId:i})=>{const{currentUser:r}=c.useContext(y);return s.jsx(s.Fragment,{children:r.uid===i?s.jsxs("div",{onClick:()=>{console.log(r.uid),console.log(i)},className:`${w.ownMessage} ${w.container}`,children:[s.jsx("span",{className:w.time,children:a}),s.jsx("p",{children:t})]}):s.jsxs("div",{onClick:()=>{console.log(r.uid),console.log(i)},className:`${w.container} ${w.notMyMessage}`,children:[s.jsx("p",{children:t}),s.jsx("span",{className:w.time,children:a})]})})},Ne="_container_7zog1_1",Se="_inputWrapper_7zog1_11",Ie="_fileInputLabel_7zog1_27",Ce="_textInput_7zog1_35",be="_sendBtn_7zog1_41",S={container:Ne,inputWrapper:Se,fileInputLabel:Ie,textInput:Ce,sendBtn:be},b=c.createContext({}),Le=({children:t})=>{const a={chatId:"",user:{}},{currentUser:i}=c.useContext(y),r=(d,l)=>{if(l.type==="CHANGE_USER"){if(console.log(l.payload),i.uid)return{user:l.payload,chatId:i.uid>l.payload.uid?i.uid+l.payload.uid:l.payload.uid+i.uid}}else return d},[e,n]=c.useReducer(r,a);return s.jsx(b.Provider,{value:{data:e,dispatch:n},children:t})},Ue=()=>{const[t,a]=c.useState(""),[i,r]=c.useState(),{data:e}=c.useContext(b),{currentUser:n}=c.useContext(y),d=async l=>{var u,j,o,p;if(l.preventDefault(),t!=="")if(console.log(i),i){const f=P(z,L()),h=D(f,i);h.on("state_changed",m=>{const Z=m.bytesTransferred/m.totalBytes*100;switch(console.log("Upload is "+Z+"% done"),m.state){case"paused":console.log("Upload is paused");break;case"running":console.log("Upload is running");break}},m=>{console.log(String(m))},()=>{F(h.snapshot.ref).then(async m=>{e!=null&&e.chatId&&await _(x(g,"chats",e==null?void 0:e.chatId),{messages:E({id:L(),text:t,senderId:n.uid,date:q.now(),img:m})})})}),n.uid&&await _(x(g,"userChats",n.uid),{[(e==null?void 0:e.chatId)+".lastMessage"]:{text:t},[(e==null?void 0:e.chatId)+".date"]:N()}),e&&((u=e.user)!=null&&u.uid)&&await _(x(g,"userChats",(j=e.user)==null?void 0:j.uid),{[(e==null?void 0:e.chatId)+".lastMessage"]:{text:t},[(e==null?void 0:e.chatId)+".date"]:N()}),r(void 0),a(""),console.log(t)}else console.log(e==null?void 0:e.chatId),e!=null&&e.chatId&&(console.log("90"),await _(x(g,"chats",e==null?void 0:e.chatId),{messages:E({id:L(),text:t,senderId:n.uid,date:q.now()})})),n.uid&&(console.log("103"),await _(x(g,"userChats",n.uid),{[(e==null?void 0:e.chatId)+".lastMessage"]:{text:t},[(e==null?void 0:e.chatId)+".date"]:N()})),e&&((o=e.user)!=null&&o.uid)&&(console.log("114"),await _(x(g,"userChats",(p=e.user)==null?void 0:p.uid),{[(e==null?void 0:e.chatId)+".lastMessage"]:{text:t},[(e==null?void 0:e.chatId)+".date"]:N()})),a("")};return s.jsx("div",{className:S.container,children:s.jsxs("form",{onSubmit:l=>d(l),children:[s.jsxs("div",{className:S.inputWrapper,children:[s.jsx("label",{htmlFor:"fileInput",className:S.fileInputLabel,children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#fff",children:s.jsx("path",{d:"M640-520v-200h80v200h-80ZM440-244q-35-10-57.5-39T360-350v-370h80v476Zm30 164q-104 0-177-73t-73-177v-370q0-75 52.5-127.5T400-880q75 0 127.5 52.5T580-700v300h-80v-300q-1-42-29.5-71T400-800q-42 0-71 29t-29 71v370q-1 71 49 120.5T470-160q25 0 47.5-6.5T560-186v89q-21 8-43.5 12.5T470-80Zm170-40v-120H520v-80h120v-120h80v120h120v80H720v120h-80Z"})})}),s.jsx("input",{className:S.textInput,value:t,onChange:l=>a(l.target.value)}),s.jsx("input",{type:"file",id:"fileInput",onChange:l=>{l.target.files&&r(l.target.files[0])}})]}),s.jsx("button",{className:S.sendBtn,type:"submit",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#fff",children:s.jsx("path",{d:"M120-160v-640l760 320-760 320Zm80-120 474-200-474-200v140l240 60-240 60v140Zm0 0v-400 400Z"})})})]})})},Me=()=>{const{data:t}=c.useContext(b),[a,i]=c.useState([]);return c.useEffect(()=>{if(t!=null&&t.chatId){const r=W(x(g,"chats",t.chatId),e=>{e.exists()&&i(e.data().messages),console.log(e.data())});return()=>{r()}}},[t==null?void 0:t.chatId]),s.jsx("div",{className:M.container,children:(t==null?void 0:t.chatId)!==""?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:M.topbar,children:t!=null&&t.user?s.jsxs(s.Fragment,{children:[s.jsx("img",{src:t.user.photoURL,alt:"User photo"}),s.jsx("p",{children:t.user.displayName})]}):s.jsx("p",{children:"USER NOT FOUND"})}),s.jsxs("div",{className:M.messageWrapper,children:[a.length>0&&a.map(r=>s.jsx(we,{messageText:r.text,senderId:r.senderId,time:"21:15"},r.id)),s.jsx(Ue,{})]})]}):null})},Re="_container_1rhxh_1",Te="_wrapper_1rhxh_15",$e="_username_1rhxh_21",Ee="_message_1rhxh_24",v={container:Re,wrapper:Te,username:$e,message:Ee},B=({chatUser:t,setSearchedUser:a,isSearched:i,setUserQuery:r})=>{const{currentUser:e}=c.useContext(y),{dispatch:n}=c.useContext(b),[d,l]=c.useState({});c.useEffect(()=>{if(e!=null&&e.uid){const o=W(x(g,"userChats",e.uid),p=>{const f=p.data();f!==void 0&&(l(f),console.log(Object.entries(f).sort((h,m)=>m[1].date!==null&&h[1].date!==null?m[1].date.seconds-h[1].date.seconds:m[1].date!==null?m[1].date.seconds:h[1].date.seconds)))});return()=>{o()}}},[e.uid]);const u=async()=>{if(e.uid!==""&&e.uid!==void 0){const o=e.uid>t.uid?e.uid+t.uid:t.uid+e.uid;try{const p=await X(x(g,"chats",o));p.exists()||(await T(x(g,"chats",o),{messages:[]}),await _(x(g,"userChats",e.uid),{[o+".userInfo"]:{uid:t.uid,displayName:t.displayName,photoURL:t.photoURL},[o+".date"]:N()}),await _(x(g,"userChats",t.uid),{[o+".userInfo"]:{uid:e.uid,displayName:e.displayName,photoURL:e.photoURL},[o+".date"]:N()})),i&&(a({displayName:"",photoURL:"",lastMessage:"",uid:""}),r("")),console.log(p)}catch(p){console.log(p)}}console.log(e.uid+t.uid)},j=o=>{n({type:"CHANGE_USER",payload:o})};return s.jsx(s.Fragment,{children:i?s.jsxs("div",{onClick:()=>{u(),j(t)},className:v.container,children:[s.jsx("img",{src:t.photoURL}),s.jsx("div",{className:v.wrapper,children:s.jsx("p",{className:v.username,children:t.displayName})})]}):s.jsx(s.Fragment,{children:Object.entries(d).sort((o,p)=>p[1].date!==null&&o[1].date!==null?p[1].date.seconds-o[1].date.seconds:p[1].date!==null?p[1].date.seconds:o[1].date.seconds).map(o=>{var p,f;return s.jsxs("div",{className:v.container,onClick:()=>{j(o[1].userInfo),console.log(o)},children:[s.jsx("img",{src:o[1].userInfo.photoURL}),s.jsxs("div",{className:v.wrapper,children:[s.jsx("p",{className:v.username,children:o[1].userInfo.displayName}),((f=(p=o[1])==null?void 0:p.lastMessage)==null?void 0:f.text)!==void 0&&s.jsx("p",{className:v.message,children:o[1].lastMessage.text})]})]},o[0])})})})},qe="_container_17q7h_1",Be={container:qe},Ae=({setSearchedUser:t,userQuery:a,setUserQuery:i})=>{const[r,e]=c.useState(""),n=async d=>{const l=ee(te(g,"users"),se("email","==",d));try{const u=await ne(l);console.log(u.docs.length),u.docs.length>0?u.forEach(j=>{const o=j.data();console.log(o),t({displayName:o.displayName,photoURL:o.photoURL,lastMessage:"???",uid:o.uid})}):t({displayName:"",photoURL:"",lastMessage:"",uid:""})}catch(u){e(String(u)),console.log(u)}};return s.jsxs("div",{className:Be.container,children:[s.jsx("input",{type:"text",placeholder:"Search email",onChange:d=>{i(d.target.value),n(d.target.value)},value:a}),r!==""&&s.jsx("p",{children:r})]})},Oe="_container_8th3l_1",Pe="_navbar_8th3l_5",De="_logoutBtn_8th3l_12",R={container:Oe,navbar:Pe,logoutBtn:De},Fe=()=>{const t=$(),{currentUser:a}=c.useContext(y),[i,r]=c.useState({displayName:"",photoURL:"",uid:"",lastMessage:""}),[e,n]=c.useState(""),[d]=c.useState({displayName:"Temp User",photoURL:"https://source.unsplash.com/random",lastMessage:"Last message text",uid:"qwertyuioQWERTYUIO"});return s.jsxs("div",{className:R.container,children:[s.jsxs("div",{className:R.navbar,children:[s.jsx("img",{src:a==null?void 0:a.photoURL,alt:a.displayName}),s.jsx("span",{children:a.displayName}),s.jsx("button",{className:R.logoutBtn,onClick:()=>{oe(C).then(()=>{t("../login",{replace:!0})}).catch(l=>{console.log(l)})},children:"Logout"})]}),s.jsx(Ae,{setSearchedUser:r,userQuery:e,setUserQuery:n}),i.displayName!==""&&s.jsx(B,{chatUser:i,setSearchedUser:r,isSearched:!0,setUserQuery:n}),s.jsx(B,{chatUser:d})]})},We="_container_1whll_1",ke="_wrapper_1whll_5",ze="_loadingScreen_1whll_9",Ze="_loader_1whll_18",He="_rotation_1whll_1",I={container:We,wrapper:ke,loadingScreen:ze,loader:Ze,rotation:He},Ke=()=>{const{currentUser:t,isLoading:a}=c.useContext(y),[i,r]=c.useState(t);return c.useEffect(()=>{r(t)},[t,i]),a?s.jsx("div",{className:I.loadingScreen,children:s.jsx("span",{className:I.loader})}):"email"in t?s.jsx("div",{className:I.container,children:s.jsxs("div",{className:I.wrapper,children:[s.jsx(Fe,{}),s.jsx(Me,{})]})}):s.jsx(ce,{to:{pathname:"/login"}})},Qe="_container_1y4t8_1",Ge="_error_1y4t8_40",A={container:Qe,error:Ge},Ve=()=>{const[t,a]=c.useState(""),i=$(),r=e=>{e.preventDefault();const n=e.currentTarget[0].value,d=e.currentTarget[1].value,l=e.currentTarget[2].value,u=e.currentTarget[4],j=u.files?u.files[0]:null;console.log(n);try{const o=ae(C,d,l),p=P(z,d);if(j){const f=D(p,j);f.on("state_changed",h=>{const m=h.bytesTransferred/h.totalBytes*100;switch(console.log("Upload is "+m+"% done"),h.state){case"paused":console.log("Upload is paused");break;case"running":console.log("Upload is running");break}},h=>{a(String(h))},()=>{F(f.snapshot.ref).then(async h=>{await re((await o).user,{displayName:n,photoURL:h}),await T(x(g,"users",(await o).user.uid),{uid:(await o).user.uid,displayName:n,email:d,photoURL:h}),await T(x(g,"userChats",(await o).user.uid),{})}),i("../",{replace:!0})})}}catch(o){a(String(o)),console.log(o)}};return s.jsxs("div",{className:A.container,children:[s.jsxs("form",{onSubmit:e=>r(e),children:[s.jsx("input",{type:"text",autoComplete:"username",placeholder:"Username"}),s.jsx("input",{type:"email",autoComplete:"email",placeholder:"E-mail"}),s.jsx("input",{type:"password",autoComplete:"new-password",placeholder:"Password"}),s.jsx("input",{type:"password",autoComplete:"new-password",placeholder:"Confirm password"}),s.jsx("input",{type:"file",required:!0}),s.jsx("button",{type:"submit",children:"Sign Up"}),t!==""&&s.jsx("span",{className:A.error,children:"Something went wrong"})]}),s.jsxs("p",{children:["Already have an account? ",s.jsx(k,{to:"/login",children:"Log In"})]})]})},Ye="_container_1azqi_1",Je="_error_1azqi_40",O={container:Ye,error:Je},Xe=()=>{const[t,a]=c.useState(""),{setIsLoading:i}=c.useContext(y),r=$(),e=async n=>{n.preventDefault();const d=n.currentTarget[0].value,l=n.currentTarget[1].value;try{try{await ie(C,d,l)}catch(u){throw a(String(u)),u}i(!0),r("../",{replace:!0})}catch(u){throw a(String(u)),u}};return s.jsxs("div",{className:O.container,children:[s.jsxs("form",{onSubmit:n=>e(n),children:[s.jsx("input",{type:"email",autoComplete:"email",placeholder:"E-mail"}),s.jsx("input",{type:"password",autoComplete:"current-password",placeholder:"Password"}),s.jsx("button",{children:"Login"}),t!==""&&s.jsxs("span",{className:O.error,children:["Something went wrong ",t]})]}),s.jsxs("p",{children:["Don't have an account? ",s.jsx(k,{to:"/register",children:"Sign Up"})]})]})};function es(){return s.jsx("div",{className:pe.container,children:s.jsxs(le,{children:[s.jsx(U,{path:"/",element:s.jsx(Ke,{})}),s.jsx(U,{path:"/register",element:s.jsx(Ve,{})}),s.jsx(U,{path:"/login",element:s.jsx(Xe,{})})]})})}K.createRoot(document.getElementById("root")).render(s.jsx(H.StrictMode,{children:s.jsx(ve,{children:s.jsx(Le,{children:s.jsx(de,{children:s.jsx(es,{})})})})}));
