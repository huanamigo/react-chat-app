import{j as s,r as i,a as H}from"./react-BrP7bTIu.js";import{c as z}from"./react-dom-BtizlmEl.js";import{i as K,g as Q,a as G,b as V,o as Y,c as O,u as D,d as W,e as j,f as M,T as $,h as m,s as v,j as F,k as J,l as T,q as X,w as ee,m as se,n as te,p as ne,t as ae,v as re,x as oe}from"./@firebase-DTXE1Cas.js";import"./firebase-BeS6FGRT.js";import{v as b}from"./uuid-D8aEg3BZ.js";import{d as E,e as ie,f as ce,g as L}from"./react-router-C0nYgrbg.js";import{N as k,H as le}from"./react-router-dom-iW47g7mf.js";import"./scheduler-CzFDRTuY.js";import"./tslib-BGVaTf34.js";import"./idb-BXWtuYvb.js";import"./@remix-run-BgBg4VcQ.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))l(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const d of n.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&l(d)}).observe(document,{childList:!0,subtree:!0});function c(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function l(e){if(e.ep)return;e.ep=!0;const n=c(e);fetch(e.href,n)}})();const de="_container_11yjs_2",ue={container:de},pe="_container_1g0o2_1",he="_topbar_1g0o2_9",me="_messageWrapper_1g0o2_25",U={container:pe,topbar:he,messageWrapper:me},ge="_container_tsfc4_1",xe="_time_tsfc4_13",q={container:ge,time:xe},fe=({messageText:t,time:a})=>s.jsxs("div",{className:q.container,children:[s.jsx("p",{children:t}),s.jsx("span",{className:q.time,children:a})]}),je="_container_1yh78_1",_e="_inputWrapper_1yh78_6",ye="_fileInputLabel_1yh78_22",ve="_textInput_1yh78_30",we="_sendBtn_1yh78_35",w={container:je,inputWrapper:_e,fileInputLabel:ye,textInput:ve,sendBtn:we},Ne={apiKey:"AIzaSyAB80-tZTx63iK-eSokF2n1HNM25fO_rZ4",authDomain:"react-chat-app-cf377.firebaseapp.com",projectId:"react-chat-app-cf377",storageBucket:"react-chat-app-cf377.appspot.com",messagingSenderId:"333727045415",appId:"1:333727045415:web:07aac7a056b70e402bbb02"};K(Ne);const I=Q(),Z=G(),h=V(),y=i.createContext({currentUser:{},isLoading:!0,setIsLoading:t=>{}}),Ie=({children:t})=>{const[a,c]=i.useState({}),[l,e]=i.useState(!0);i.useEffect(()=>{const d=Y(I,o=>{o&&c(o),e(!1)});return()=>{d()}},[a]);const n={currentUser:a,isLoading:l,setIsLoading:e};return s.jsx(y.Provider,{value:n,children:t})},S=i.createContext({}),Se=({children:t})=>{const a={chatId:"",user:{}},{currentUser:c}=i.useContext(y),l=(d,o)=>{if(o.type==="CHANGE_USER"){if(console.log(o.payload),c.uid)return{user:o.payload,chatId:c.uid>o.payload.uid?c.uid+o.payload.uid:o.payload.uid+c.uid}}else return d},[e,n]=i.useReducer(l,a);return s.jsx(S.Provider,{value:{data:e,dispatch:n},children:t})},Ce=()=>{const[t,a]=i.useState(""),[c,l]=i.useState(),{data:e}=i.useContext(S),{currentUser:n}=i.useContext(y),d=async()=>{var o,u,f,r;if(console.log(c),c){const g=O(Z,b()),x=D(g,c);x.on("state_changed",p=>{const C=p.bytesTransferred/p.totalBytes*100;switch(console.log("Upload is "+C+"% done"),p.state){case"paused":console.log("Upload is paused");break;case"running":console.log("Upload is running");break}},p=>{console.log(String(p))},()=>{W(x.snapshot.ref).then(async p=>{e!=null&&e.chatId&&await j(m(h,"chats",e==null?void 0:e.chatId),{messages:M({id:b(),text:t,senderId:n.uid,date:$.now(),img:p})})})}),n.uid&&await j(m(h,"userChats",n.uid),{[(e==null?void 0:e.chatId)+".lastMessage"]:{text:t},[(e==null?void 0:e.chatId)+".date"]:v()}),e&&((o=e.user)!=null&&o.uid)&&await j(m(h,"userChats",(u=e.user)==null?void 0:u.uid),{[(e==null?void 0:e.chatId)+".lastMessage"]:{text:t},[(e==null?void 0:e.chatId)+".date"]:v()}),l(void 0),a(""),console.log(t)}else console.log(e==null?void 0:e.chatId),e!=null&&e.chatId&&await j(m(h,"chats",e==null?void 0:e.chatId),{messages:M({id:b(),text:t,senderId:n.uid,date:$.now()})}),n.uid&&await j(m(h,"userChats",n.uid),{[(e==null?void 0:e.chatId)+".lastMessage"]:{text:t},[(e==null?void 0:e.chatId)+".date"]:v()}),e&&((f=e.user)!=null&&f.uid)&&await j(m(h,"userChats",(r=e.user)==null?void 0:r.uid),{[(e==null?void 0:e.chatId)+".lastMessage"]:{text:t},[(e==null?void 0:e.chatId)+".date"]:v()}),a("")};return s.jsxs("div",{className:w.container,children:[s.jsxs("div",{className:w.inputWrapper,children:[s.jsx("label",{htmlFor:"fileInput",className:w.fileInputLabel,children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#fff",children:s.jsx("path",{d:"M640-520v-200h80v200h-80ZM440-244q-35-10-57.5-39T360-350v-370h80v476Zm30 164q-104 0-177-73t-73-177v-370q0-75 52.5-127.5T400-880q75 0 127.5 52.5T580-700v300h-80v-300q-1-42-29.5-71T400-800q-42 0-71 29t-29 71v370q-1 71 49 120.5T470-160q25 0 47.5-6.5T560-186v89q-21 8-43.5 12.5T470-80Zm170-40v-120H520v-80h120v-120h80v120h120v80H720v120h-80Z"})})}),s.jsx("input",{className:w.textInput,value:t,onChange:o=>a(o.target.value)}),s.jsx("input",{type:"file",id:"fileInput",onChange:o=>{o.target.files&&l(o.target.files[0])}})]}),s.jsx("button",{className:w.sendBtn,onClick:d,children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#fff",children:s.jsx("path",{d:"M120-160v-640l760 320-760 320Zm80-120 474-200-474-200v140l240 60-240 60v140Zm0 0v-400 400Z"})})})]})},be=()=>{const{data:t}=i.useContext(S),[a,c]=i.useState([]);return i.useEffect(()=>{if(t!=null&&t.chatId){const l=F(m(h,"chats",t.chatId),e=>{e.exists()&&c(e.data().messages),console.log(e.data())});return()=>{l()}}},[t==null?void 0:t.chatId]),s.jsx("div",{className:U.container,children:(t==null?void 0:t.chatId)!==""?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:U.topbar,children:t!=null&&t.user?s.jsxs(s.Fragment,{children:[s.jsx("img",{src:t.user.photoURL,alt:"User photo"}),s.jsx("p",{children:t.user.displayName})]}):s.jsx("p",{children:"USER NOT FOUND"})}),s.jsxs("div",{className:U.messageWrapper,children:[a.length>0&&a.map(l=>s.jsx(fe,{messageText:l.text,time:"21:15"},l.id)),s.jsx(Ce,{})]})]}):null})},Le="_container_1rhxh_1",Ue="_wrapper_1rhxh_15",Re="_username_1rhxh_21",Te="_message_1rhxh_24",_={container:Le,wrapper:Ue,username:Re,message:Te},B=({chatUser:t,setSearchedUser:a,isSearched:c,setUserQuery:l})=>{const{currentUser:e}=i.useContext(y),{dispatch:n}=i.useContext(S),[d,o]=i.useState({});i.useEffect(()=>{if(e!=null&&e.uid){const r=F(m(h,"userChats",e.uid),g=>{const x=g.data();x!==void 0&&o(x)});return()=>{r()}}},[e.uid]);const u=async()=>{if(e.uid!==""&&e.uid!==void 0){const r=e.uid>t.uid?e.uid+t.uid:t.uid+e.uid;try{const g=await J(m(h,"chats",r));g.exists()||(await T(m(h,"chats",r),{messages:[]}),await j(m(h,"userChats",e.uid),{[r+".userInfo"]:{uid:t.uid,displayName:t.displayName,photoURL:t.photoURL},[r+".date"]:v()}),await j(m(h,"userChats",t.uid),{[r+".userInfo"]:{uid:e.uid,displayName:e.displayName,photoURL:e.photoURL},[r+".date"]:v()})),c&&(a({displayName:"",photoURL:"",lastMessage:"",uid:""}),l("")),console.log(g)}catch(g){console.log(g)}}console.log(e.uid+t.uid)},f=r=>{n({type:"CHANGE_USER",payload:r})};return s.jsx(s.Fragment,{children:c?s.jsxs("div",{onClick:()=>{u(),f(t)},className:_.container,children:[s.jsx("img",{src:t.photoURL}),s.jsx("div",{className:_.wrapper,children:s.jsx("p",{className:_.username,children:t.displayName})})]}):s.jsx(s.Fragment,{children:Object.entries(d).map(r=>{var g,x;return s.jsxs("div",{className:_.container,onClick:()=>{f(r[1].userInfo),console.log(r[1].lastMessage.text)},children:[s.jsx("img",{src:r[1].userInfo.photoURL}),s.jsxs("div",{className:_.wrapper,children:[s.jsx("p",{className:_.username,children:r[1].userInfo.displayName}),((x=(g=r[1])==null?void 0:g.lastMessage)==null?void 0:x.text)!==void 0&&s.jsx("p",{className:_.message,children:r[1].lastMessage.text})]})]},r[0])})})})},Ee="_container_17q7h_1",Me={container:Ee},$e=({setSearchedUser:t,userQuery:a,setUserQuery:c})=>{const[l,e]=i.useState(""),n=async d=>{const o=X(se(h,"users"),ee("email","==",d));try{const u=await te(o);console.log(u.docs.length),u.docs.length>0?u.forEach(f=>{const r=f.data();console.log(r),t({displayName:r.displayName,photoURL:r.photoURL,lastMessage:"???",uid:r.uid})}):t({displayName:"",photoURL:"",lastMessage:"",uid:""})}catch(u){e(String(u)),console.log(u)}};return s.jsxs("div",{className:Me.container,children:[s.jsx("input",{type:"text",placeholder:"Search email",onChange:d=>{c(d.target.value),n(d.target.value)},value:a}),l!==""&&s.jsx("p",{children:l})]})},qe="_container_z4dfh_1",Be="_navbar_z4dfh_5",Ae="_logoutBtn_z4dfh_12",R={container:qe,navbar:Be,logoutBtn:Ae},Pe=()=>{const t=E(),{currentUser:a}=i.useContext(y),[c,l]=i.useState({displayName:"",photoURL:"",uid:"",lastMessage:""}),[e,n]=i.useState(""),[d]=i.useState({displayName:"Temp User",photoURL:"https://source.unsplash.com/random",lastMessage:"Last message text",uid:"qwertyuioQWERTYUIO"});return s.jsxs("div",{className:R.container,children:[s.jsxs("div",{className:R.navbar,children:[s.jsx("img",{src:a==null?void 0:a.photoURL,alt:a.displayName}),s.jsx("span",{children:a.displayName}),s.jsx("button",{className:R.logoutBtn,onClick:()=>{ne(I).then(()=>{t("../login",{replace:!0})}).catch(o=>{console.log(o)})},children:"Logout"})]}),s.jsx($e,{setSearchedUser:l,userQuery:e,setUserQuery:n}),c.displayName!==""&&s.jsx(B,{chatUser:c,setSearchedUser:l,isSearched:!0,setUserQuery:n}),s.jsx(B,{chatUser:d})]})},Oe="_container_1whll_1",De="_wrapper_1whll_5",We="_loadingScreen_1whll_9",Fe="_loader_1whll_18",ke="_rotation_1whll_1",N={container:Oe,wrapper:De,loadingScreen:We,loader:Fe,rotation:ke},Ze=()=>{const{currentUser:t,isLoading:a}=i.useContext(y);return a?s.jsx("div",{className:N.loadingScreen,children:s.jsx("span",{className:N.loader})}):"email"in t?s.jsx("div",{className:N.container,children:s.jsxs("div",{className:N.wrapper,children:[s.jsx(Pe,{}),s.jsx(be,{})]})}):s.jsx(ie,{to:{pathname:"/login"}})},He="_container_1y4t8_1",ze="_error_1y4t8_40",A={container:He,error:ze},Ke=()=>{const[t,a]=i.useState(""),c=E(),l=e=>{e.preventDefault();const n=e.currentTarget[0].value,d=e.currentTarget[1].value,o=e.currentTarget[2].value,u=e.currentTarget[4],f=u.files?u.files[0]:null;console.log(n);try{const r=ae(I,d,o),g=O(Z,n);if(f){const x=D(g,f);x.on("state_changed",p=>{const C=p.bytesTransferred/p.totalBytes*100;switch(console.log("Upload is "+C+"% done"),p.state){case"paused":console.log("Upload is paused");break;case"running":console.log("Upload is running");break}},p=>{a(String(p))},()=>{W(x.snapshot.ref).then(async p=>{await re((await r).user,{displayName:n,photoURL:p}),await T(m(h,"users",(await r).user.uid),{uid:(await r).user.uid,displayName:n,email:d,photoURL:p}),await T(m(h,"userChats",(await r).user.uid),{})}),c("../",{replace:!0})})}}catch(r){a(String(r)),console.log(r)}};return s.jsxs("div",{className:A.container,children:[s.jsxs("form",{onSubmit:e=>l(e),children:[s.jsx("input",{type:"text",autoComplete:"username",placeholder:"Username"}),s.jsx("input",{type:"email",autoComplete:"email",placeholder:"E-mail"}),s.jsx("input",{type:"password",autoComplete:"new-password",placeholder:"Password"}),s.jsx("input",{type:"password",autoComplete:"new-password",placeholder:"Confirm password"}),s.jsx("input",{type:"file"}),s.jsx("button",{children:"Sign Up"}),t!==""&&s.jsx("span",{className:A.error,children:"Something went wrong"})]}),s.jsxs("p",{children:["Already have an account? ",s.jsx(k,{to:"/login",children:"Log In"})]})]})},Qe="_container_1azqi_1",Ge="_error_1azqi_40",P={container:Qe,error:Ge},Ve=()=>{const[t,a]=i.useState(""),{setIsLoading:c}=i.useContext(y),l=E(),e=async n=>{n.preventDefault();const d=n.currentTarget[0].value,o=n.currentTarget[1].value;try{try{await oe(I,d,o)}catch(u){throw a(String(u)),u}c(!0),l("../",{replace:!0})}catch(u){throw a(String(u)),u}};return s.jsxs("div",{className:P.container,children:[s.jsxs("form",{onSubmit:n=>e(n),children:[s.jsx("input",{type:"email",autoComplete:"email",placeholder:"E-mail"}),s.jsx("input",{type:"password",autoComplete:"current-password",placeholder:"Password"}),s.jsx("button",{children:"Login"}),t!==""&&s.jsxs("span",{className:P.error,children:["Something went wrong ",t]})]}),s.jsxs("p",{children:["Don't have an account? ",s.jsx(k,{to:"/register",children:"Sign Up"})]})]})};function Ye(){return s.jsx("div",{className:ue.container,children:s.jsxs(ce,{children:[s.jsx(L,{path:"/",element:s.jsx(Ze,{})}),s.jsx(L,{path:"/register",element:s.jsx(Ke,{})}),s.jsx(L,{path:"/login",element:s.jsx(Ve,{})})]})})}z.createRoot(document.getElementById("root")).render(s.jsx(H.StrictMode,{children:s.jsx(Ie,{children:s.jsx(Se,{children:s.jsx(le,{children:s.jsx(Ye,{})})})})}));
