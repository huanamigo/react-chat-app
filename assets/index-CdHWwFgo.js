import{j as e,r as l,a as M}from"./react-BrP7bTIu.js";import{c as O}from"./react-dom-BtizlmEl.js";import{i as B,g as D,a as W,b as k,o as H,q as E,c as I,w as T,d as R,s as z,e as F,f as K,u as Y,h as Z,j as Q,k as N,l as b,m as V}from"./@firebase-Ce25c52T.js";import"./firebase-c1Q7bdfA.js";import{d as w,e as G,f as J,g as f}from"./react-router-C0nYgrbg.js";import{N as A,H as X}from"./react-router-dom-iW47g7mf.js";import"./scheduler-CzFDRTuY.js";import"./tslib-BGVaTf34.js";import"./idb-BXWtuYvb.js";import"./@remix-run-BgBg4VcQ.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))c(s);new MutationObserver(s=>{for(const t of s)if(t.type==="childList")for(const o of t.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&c(o)}).observe(document,{childList:!0,subtree:!0});function a(s){const t={};return s.integrity&&(t.integrity=s.integrity),s.referrerPolicy&&(t.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?t.credentials="include":s.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function c(s){if(s.ep)return;s.ep=!0;const t=a(s);fetch(s.href,t)}})();const ee="_container_11yjs_2",se={container:ee},te="_container_ashy1_1",re={container:te},ne="_container_12177_1",ae="_time_12177_12",C={container:ne,time:ae},g=({messageText:n,time:r})=>e.jsxs("div",{className:C.container,children:[e.jsx("span",{children:n}),e.jsx("span",{className:C.time,children:r})]}),oe="_container_6gyfo_1",ce={container:oe},ie=()=>e.jsx("div",{className:ce.container,children:e.jsx("textarea",{})}),le=()=>e.jsxs("div",{className:re.container,children:[e.jsx(g,{messageText:"111111111111111111111111",time:"15:40"}),e.jsx(g,{messageText:"22222222222222222222",time:"15:40"}),e.jsx(g,{messageText:"333333333333333333333333333333333",time:"15:40"}),e.jsx(g,{messageText:"444444444444444444",time:"15:40"}),e.jsx(g,{messageText:"55555555555555555555555555",time:"15:40"}),e.jsx(ie,{})]}),de="_container_t6ds5_1",ue="_wrapper_t6ds5_14",pe="_username_t6ds5_20",me="_message_t6ds5_23",m={container:de,wrapper:ue,username:pe,message:me},ge={apiKey:"AIzaSyAB80-tZTx63iK-eSokF2n1HNM25fO_rZ4",authDomain:"react-chat-app-cf377.firebaseapp.com",projectId:"react-chat-app-cf377",storageBucket:"react-chat-app-cf377.appspot.com",messagingSenderId:"333727045415",appId:"1:333727045415:web:07aac7a056b70e402bbb02"};B(ge);const _=D(),he=W(),j=k(),h=l.createContext({currentUser:{},isLoading:!0,setIsLoading:n=>{}}),xe=({children:n})=>{const[r,a]=l.useState({}),[c,s]=l.useState(!0);l.useEffect(()=>{const o=H(_,d=>{d&&a(d),s(!1)});return()=>{o()}},[r]);const t={currentUser:r,isLoading:c,setIsLoading:s};return e.jsx(h.Provider,{value:t,children:n})},L=({chatUser:n,isSearched:r})=>{const{currentUser:a}=l.useContext(h),c=async()=>{if(a.uid!==""&&a.uid!==void 0){const s=a.uid>n.uid?a.uid+n.uid:n.uid+a.uid;console.log(s);try{const t=E(I(j,"chats"),T("uid","==",s)),o=await R(t);console.log(o)}catch(t){console.log(t)}}console.log(a.uid+n.uid)};return e.jsxs("div",{className:m.container,children:[e.jsx("img",{src:n.img}),r?e.jsx("div",{onClick:()=>c(),className:m.wrapper,children:e.jsx("p",{className:m.username,children:n.username})}):e.jsxs("div",{className:m.wrapper,children:[e.jsx("p",{className:m.username,children:n.username}),e.jsx("p",{className:m.message,children:n.lastMessage})]})]})},je="_container_17q7h_1",_e={container:je},fe=({setSearchedUser:n})=>{const[r,a]=l.useState(""),c=async s=>{const t=E(I(j,"users"),T("email","==",s));try{const o=await R(t);console.log(o.docs.length),o.docs.length>0?o.forEach(d=>{const i=d.data();console.log(i),n({username:i.displayName,img:i.photoURL,lastMessage:"???",uid:i.uid})}):n({username:"",img:"",lastMessage:"",uid:""})}catch(o){a(String(o)),console.log(o)}};return e.jsxs("div",{className:_e.container,children:[e.jsx("input",{type:"text",placeholder:"Search email",onChange:s=>{c(s.target.value)}}),r!==""&&e.jsx("p",{children:r})]})},ye="_container_yqqb2_1",we="_navbar_yqqb2_5",ve="_logoutBtn_yqqb2_11",y={container:ye,navbar:we,logoutBtn:ve},Se=()=>{const n=w(),{currentUser:r}=l.useContext(h),[a,c]=l.useState({username:"",img:"",lastMessage:"",uid:""}),[s]=l.useState({username:"temp",img:"https://source.unsplash.com/random",lastMessage:"jazda",uid:"qwertyuioQWERTYUIO"});return e.jsxs("div",{className:y.container,children:[e.jsxs("div",{className:y.navbar,children:[e.jsx("img",{src:r==null?void 0:r.photoURL,alt:r.displayName}),e.jsx("span",{children:r.displayName}),e.jsx("button",{className:y.logoutBtn,onClick:()=>{z(_).then(()=>{console.log("WYLogoWANO"),n("../login",{replace:!0})}).catch(t=>{console.log(t)})},children:"Logout"})]}),e.jsx(fe,{setSearchedUser:c}),a.username!==""&&e.jsx(L,{chatUser:a,isSearched:!0}),e.jsx(L,{chatUser:s})]})},Ne="_container_1a1q7_1",be="_wrapper_1a1q7_5",Ce="_loadingScreen_1a1q7_9",Le="_loader_1a1q7_18",$e="_rotation_1a1q7_1",x={container:Ne,wrapper:be,loadingScreen:Ce,loader:Le,rotation:$e},qe=()=>{const{currentUser:n,isLoading:r}=l.useContext(h);return console.log(n),console.log(r),r?e.jsx("div",{className:x.loadingScreen,children:e.jsx("span",{className:x.loader})}):"email"in n?e.jsx("div",{className:x.container,children:e.jsxs("div",{className:x.wrapper,children:[e.jsx(Se,{}),e.jsx(le,{})]})}):e.jsx(G,{to:{pathname:"/login"}})},Ee="_container_rtgsm_1",Ie="_error_rtgsm_21",$={container:Ee,error:Ie},Te=()=>{const[n,r]=l.useState(""),a=w(),c=s=>{s.preventDefault();const t=s.currentTarget[0].value,o=s.currentTarget[1].value,d=s.currentTarget[2].value,i=s.currentTarget[4],v=i.files?i.files[0]:null;console.log(t);try{const p=F(_,o,d),U=K(he,t);if(v){const S=Y(U,v);S.on("state_changed",u=>{const P=u.bytesTransferred/u.totalBytes*100;switch(console.log("Upload is "+P+"% done"),u.state){case"paused":console.log("Upload is paused");break;case"running":console.log("Upload is running");break}},u=>{r(String(u))},()=>{Z(S.snapshot.ref).then(async u=>{await Q((await p).user,{displayName:t,photoURL:u}),await N(b(j,"users",(await p).user.uid),{uid:(await p).user.uid,displayName:t,email:o,photoURL:u}),await N(b(j,"userChats",(await p).user.uid),{})}),a("../",{replace:!0})})}}catch(p){r(String(p)),console.log(p)}};return e.jsxs("div",{className:$.container,children:[e.jsxs("form",{onSubmit:s=>c(s),children:[e.jsx("input",{type:"text",autoComplete:"username",placeholder:"Username"}),e.jsx("input",{type:"email",autoComplete:"email",placeholder:"E-mail"}),e.jsx("input",{type:"password",autoComplete:"new-password",placeholder:"Password"}),e.jsx("input",{type:"password",autoComplete:"new-password",placeholder:"Confirm password"}),e.jsx("input",{type:"file"}),e.jsx("button",{children:"Sign Up"}),n!==""&&e.jsx("span",{className:$.error,children:"Something went wrong"})]}),e.jsxs("p",{children:["Already have an account? ",e.jsx(A,{to:"/login",children:"Log In"})]})]})},Re="_container_1j0f6_1",Ae="_error_1j0f6_40",q={container:Re,error:Ae},Ue=()=>{const[n,r]=l.useState(""),{setIsLoading:a}=l.useContext(h),c=w(),s=async t=>{t.preventDefault();const o=t.currentTarget[0].value,d=t.currentTarget[1].value;try{try{await V(_,o,d)}catch(i){throw r(String(i)),i}a(!0),c("../",{replace:!0})}catch(i){throw r(String(i)),i}};return e.jsxs("div",{className:q.container,children:[e.jsxs("form",{onSubmit:t=>s(t),children:[e.jsx("input",{type:"email",autoComplete:"email",placeholder:"E-mail"}),e.jsx("input",{type:"password",autoComplete:"current-password",placeholder:"Password"}),e.jsx("button",{children:"Login"}),n!==""&&e.jsxs("span",{className:q.error,children:["Something went wrong ",n]})]}),e.jsxs("p",{children:["Don't have an account? ",e.jsx(A,{to:"/register",children:"Sign Up"})]})]})};function Pe(){return e.jsx("div",{className:se.container,children:e.jsxs(J,{children:[e.jsx(f,{path:"/",element:e.jsx(qe,{})}),e.jsx(f,{path:"/register",element:e.jsx(Te,{})}),e.jsx(f,{path:"/login",element:e.jsx(Ue,{})})]})})}O.createRoot(document.getElementById("root")).render(e.jsx(M.StrictMode,{children:e.jsx(xe,{children:e.jsx(X,{children:e.jsx(Pe,{})})})}));
