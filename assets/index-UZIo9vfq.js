import{j as s,r as i,a as H}from"./react-BrP7bTIu.js";import{c as K}from"./react-dom-BtizlmEl.js";import{i as Q,g as G,a as V,b as Y,o as J,c as z,u as D,d as O,e as _,f as M,T as $,h as m,s as w,j as W,k as X,l as T,q as ee,w as se,m as te,n as ne,p as ae,t as re,v as oe,x as ie}from"./@firebase-DTXE1Cas.js";import"./firebase-BeS6FGRT.js";import{v as C}from"./uuid-D8aEg3BZ.js";import{d as E,e as ce,f as le,g as L}from"./react-router-C0nYgrbg.js";import{N as F,H as ue}from"./react-router-dom-iW47g7mf.js";import"./scheduler-CzFDRTuY.js";import"./tslib-BGVaTf34.js";import"./idb-BXWtuYvb.js";import"./@remix-run-BgBg4VcQ.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))l(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const u of n.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&l(u)}).observe(document,{childList:!0,subtree:!0});function c(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function l(e){if(e.ep)return;e.ep=!0;const n=c(e);fetch(e.href,n)}})();const de="_container_11yjs_2",pe={container:de},he="_container_1g0o2_1",me="_topbar_1g0o2_9",ge="_messageWrapper_1g0o2_25",U={container:he,topbar:me,messageWrapper:ge},xe="_container_tsfc4_1",fe="_time_tsfc4_13",q={container:xe,time:fe},je=({messageText:t,time:a})=>s.jsxs("div",{className:q.container,children:[s.jsx("p",{children:t}),s.jsx("span",{className:q.time,children:a})]}),_e="_container_7zog1_1",ve="_inputWrapper_7zog1_11",ye="_fileInputLabel_7zog1_27",we="_textInput_7zog1_35",Ne="_sendBtn_7zog1_41",N={container:_e,inputWrapper:ve,fileInputLabel:ye,textInput:we,sendBtn:Ne},Se={apiKey:"AIzaSyAB80-tZTx63iK-eSokF2n1HNM25fO_rZ4",authDomain:"react-chat-app-cf377.firebaseapp.com",projectId:"react-chat-app-cf377",storageBucket:"react-chat-app-cf377.appspot.com",messagingSenderId:"333727045415",appId:"1:333727045415:web:07aac7a056b70e402bbb02"};Q(Se);const I=G(),Z=V(),p=Y(),y=i.createContext({currentUser:{},isLoading:!0,setIsLoading:t=>{}}),Ie=({children:t})=>{const[a,c]=i.useState({}),[l,e]=i.useState(!0);i.useEffect(()=>{const u=J(I,o=>{o&&c(o),e(!1)});return()=>{u()}},[a]);const n={currentUser:a,isLoading:l,setIsLoading:e};return s.jsx(y.Provider,{value:n,children:t})},b=i.createContext({}),be=({children:t})=>{const a={chatId:"",user:{}},{currentUser:c}=i.useContext(y),l=(u,o)=>{if(o.type==="CHANGE_USER"){if(console.log(o.payload),c.uid)return{user:o.payload,chatId:c.uid>o.payload.uid?c.uid+o.payload.uid:o.payload.uid+c.uid}}else return u},[e,n]=i.useReducer(l,a);return s.jsx(b.Provider,{value:{data:e,dispatch:n},children:t})},Ce=()=>{const[t,a]=i.useState(""),[c,l]=i.useState(),{data:e}=i.useContext(b),{currentUser:n}=i.useContext(y),u=async o=>{var d,x,r,h;if(o.preventDefault(),console.log(c),c){const f=z(Z,C()),g=D(f,c);g.on("state_changed",j=>{const k=j.bytesTransferred/j.totalBytes*100;switch(console.log("Upload is "+k+"% done"),j.state){case"paused":console.log("Upload is paused");break;case"running":console.log("Upload is running");break}},j=>{console.log(String(j))},()=>{O(g.snapshot.ref).then(async j=>{e!=null&&e.chatId&&await _(m(p,"chats",e==null?void 0:e.chatId),{messages:M({id:C(),text:t,senderId:n.uid,date:$.now(),img:j})})})}),n.uid&&await _(m(p,"userChats",n.uid),{[(e==null?void 0:e.chatId)+".lastMessage"]:{text:t},[(e==null?void 0:e.chatId)+".date"]:w()}),e&&((d=e.user)!=null&&d.uid)&&await _(m(p,"userChats",(x=e.user)==null?void 0:x.uid),{[(e==null?void 0:e.chatId)+".lastMessage"]:{text:t},[(e==null?void 0:e.chatId)+".date"]:w()}),l(void 0),a(""),console.log(t)}else console.log(e==null?void 0:e.chatId),e!=null&&e.chatId&&await _(m(p,"chats",e==null?void 0:e.chatId),{messages:M({id:C(),text:t,senderId:n.uid,date:$.now()})}),n.uid&&await _(m(p,"userChats",n.uid),{[(e==null?void 0:e.chatId)+".lastMessage"]:{text:t},[(e==null?void 0:e.chatId)+".date"]:w()}),e&&((r=e.user)!=null&&r.uid)&&await _(m(p,"userChats",(h=e.user)==null?void 0:h.uid),{[(e==null?void 0:e.chatId)+".lastMessage"]:{text:t},[(e==null?void 0:e.chatId)+".date"]:w()}),a("")};return s.jsx("div",{className:N.container,children:s.jsxs("form",{onSubmit:o=>u(o),children:[s.jsxs("div",{className:N.inputWrapper,children:[s.jsx("label",{htmlFor:"fileInput",className:N.fileInputLabel,children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#fff",children:s.jsx("path",{d:"M640-520v-200h80v200h-80ZM440-244q-35-10-57.5-39T360-350v-370h80v476Zm30 164q-104 0-177-73t-73-177v-370q0-75 52.5-127.5T400-880q75 0 127.5 52.5T580-700v300h-80v-300q-1-42-29.5-71T400-800q-42 0-71 29t-29 71v370q-1 71 49 120.5T470-160q25 0 47.5-6.5T560-186v89q-21 8-43.5 12.5T470-80Zm170-40v-120H520v-80h120v-120h80v120h120v80H720v120h-80Z"})})}),s.jsx("input",{className:N.textInput,value:t,onChange:o=>a(o.target.value)}),s.jsx("input",{type:"file",id:"fileInput",onChange:o=>{o.target.files&&l(o.target.files[0])}})]}),s.jsx("button",{className:N.sendBtn,type:"submit",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#fff",children:s.jsx("path",{d:"M120-160v-640l760 320-760 320Zm80-120 474-200-474-200v140l240 60-240 60v140Zm0 0v-400 400Z"})})})]})})},Le=()=>{const{data:t}=i.useContext(b),[a,c]=i.useState([]);return i.useEffect(()=>{if(t!=null&&t.chatId){const l=W(m(p,"chats",t.chatId),e=>{e.exists()&&c(e.data().messages),console.log(e.data())});return()=>{l()}}},[t==null?void 0:t.chatId]),s.jsx("div",{className:U.container,children:(t==null?void 0:t.chatId)!==""?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:U.topbar,children:t!=null&&t.user?s.jsxs(s.Fragment,{children:[s.jsx("img",{src:t.user.photoURL,alt:"User photo"}),s.jsx("p",{children:t.user.displayName})]}):s.jsx("p",{children:"USER NOT FOUND"})}),s.jsxs("div",{className:U.messageWrapper,children:[a.length>0&&a.map(l=>s.jsx(je,{messageText:l.text,time:"21:15"},l.id)),s.jsx(Ce,{})]})]}):null})},Ue="_container_1rhxh_1",Re="_wrapper_1rhxh_15",Te="_username_1rhxh_21",Ee="_message_1rhxh_24",v={container:Ue,wrapper:Re,username:Te,message:Ee},B=({chatUser:t,setSearchedUser:a,isSearched:c,setUserQuery:l})=>{const{currentUser:e}=i.useContext(y),{dispatch:n}=i.useContext(b),[u,o]=i.useState({});i.useEffect(()=>{if(e!=null&&e.uid){const r=W(m(p,"userChats",e.uid),h=>{const f=h.data();f!==void 0&&o(f)});return()=>{r()}}},[e.uid]);const d=async()=>{if(e.uid!==""&&e.uid!==void 0){const r=e.uid>t.uid?e.uid+t.uid:t.uid+e.uid;try{const h=await X(m(p,"chats",r));h.exists()||(await T(m(p,"chats",r),{messages:[]}),await _(m(p,"userChats",e.uid),{[r+".userInfo"]:{uid:t.uid,displayName:t.displayName,photoURL:t.photoURL},[r+".date"]:w()}),await _(m(p,"userChats",t.uid),{[r+".userInfo"]:{uid:e.uid,displayName:e.displayName,photoURL:e.photoURL},[r+".date"]:w()})),c&&(a({displayName:"",photoURL:"",lastMessage:"",uid:""}),l("")),console.log(h)}catch(h){console.log(h)}}console.log(e.uid+t.uid)},x=r=>{n({type:"CHANGE_USER",payload:r})};return s.jsx(s.Fragment,{children:c?s.jsxs("div",{onClick:()=>{d(),x(t)},className:v.container,children:[s.jsx("img",{src:t.photoURL}),s.jsx("div",{className:v.wrapper,children:s.jsx("p",{className:v.username,children:t.displayName})})]}):s.jsx(s.Fragment,{children:Object.entries(u).map(r=>{var h,f;return s.jsxs("div",{className:v.container,onClick:()=>{x(r[1].userInfo),console.log(r[1].lastMessage.text)},children:[s.jsx("img",{src:r[1].userInfo.photoURL}),s.jsxs("div",{className:v.wrapper,children:[s.jsx("p",{className:v.username,children:r[1].userInfo.displayName}),((f=(h=r[1])==null?void 0:h.lastMessage)==null?void 0:f.text)!==void 0&&s.jsx("p",{className:v.message,children:r[1].lastMessage.text})]})]},r[0])})})})},Me="_container_17q7h_1",$e={container:Me},qe=({setSearchedUser:t,userQuery:a,setUserQuery:c})=>{const[l,e]=i.useState(""),n=async u=>{const o=ee(te(p,"users"),se("email","==",u));try{const d=await ne(o);console.log(d.docs.length),d.docs.length>0?d.forEach(x=>{const r=x.data();console.log(r),t({displayName:r.displayName,photoURL:r.photoURL,lastMessage:"???",uid:r.uid})}):t({displayName:"",photoURL:"",lastMessage:"",uid:""})}catch(d){e(String(d)),console.log(d)}};return s.jsxs("div",{className:$e.container,children:[s.jsx("input",{type:"text",placeholder:"Search email",onChange:u=>{c(u.target.value),n(u.target.value)},value:a}),l!==""&&s.jsx("p",{children:l})]})},Be="_container_z4dfh_1",Ae="_navbar_z4dfh_5",Pe="_logoutBtn_z4dfh_12",R={container:Be,navbar:Ae,logoutBtn:Pe},ze=()=>{const t=E(),{currentUser:a}=i.useContext(y),[c,l]=i.useState({displayName:"",photoURL:"",uid:"",lastMessage:""}),[e,n]=i.useState(""),[u]=i.useState({displayName:"Temp User",photoURL:"https://source.unsplash.com/random",lastMessage:"Last message text",uid:"qwertyuioQWERTYUIO"});return s.jsxs("div",{className:R.container,children:[s.jsxs("div",{className:R.navbar,children:[s.jsx("img",{src:a==null?void 0:a.photoURL,alt:a.displayName}),s.jsx("span",{children:a.displayName}),s.jsx("button",{className:R.logoutBtn,onClick:()=>{ae(I).then(()=>{t("../login",{replace:!0})}).catch(o=>{console.log(o)})},children:"Logout"})]}),s.jsx(qe,{setSearchedUser:l,userQuery:e,setUserQuery:n}),c.displayName!==""&&s.jsx(B,{chatUser:c,setSearchedUser:l,isSearched:!0,setUserQuery:n}),s.jsx(B,{chatUser:u})]})},De="_container_1whll_1",Oe="_wrapper_1whll_5",We="_loadingScreen_1whll_9",Fe="_loader_1whll_18",Ze="_rotation_1whll_1",S={container:De,wrapper:Oe,loadingScreen:We,loader:Fe,rotation:Ze},ke=()=>{const{currentUser:t,isLoading:a}=i.useContext(y);return a?s.jsx("div",{className:S.loadingScreen,children:s.jsx("span",{className:S.loader})}):"email"in t?s.jsx("div",{className:S.container,children:s.jsxs("div",{className:S.wrapper,children:[s.jsx(ze,{}),s.jsx(Le,{})]})}):s.jsx(ce,{to:{pathname:"/login"}})},He="_container_1y4t8_1",Ke="_error_1y4t8_40",A={container:He,error:Ke},Qe=()=>{const[t,a]=i.useState(""),c=E(),l=e=>{e.preventDefault();const n=e.currentTarget[0].value,u=e.currentTarget[1].value,o=e.currentTarget[2].value,d=e.currentTarget[4],x=d.files?d.files[0]:null;console.log(n);try{const r=re(I,u,o),h=z(Z,n);if(x){const f=D(h,x);f.on("state_changed",g=>{const j=g.bytesTransferred/g.totalBytes*100;switch(console.log("Upload is "+j+"% done"),g.state){case"paused":console.log("Upload is paused");break;case"running":console.log("Upload is running");break}},g=>{a(String(g))},()=>{O(f.snapshot.ref).then(async g=>{await oe((await r).user,{displayName:n,photoURL:g}),await T(m(p,"users",(await r).user.uid),{uid:(await r).user.uid,displayName:n,email:u,photoURL:g}),await T(m(p,"userChats",(await r).user.uid),{})}),c("../",{replace:!0})})}}catch(r){a(String(r)),console.log(r)}};return s.jsxs("div",{className:A.container,children:[s.jsxs("form",{onSubmit:e=>l(e),children:[s.jsx("input",{type:"text",autoComplete:"username",placeholder:"Username"}),s.jsx("input",{type:"email",autoComplete:"email",placeholder:"E-mail"}),s.jsx("input",{type:"password",autoComplete:"new-password",placeholder:"Password"}),s.jsx("input",{type:"password",autoComplete:"new-password",placeholder:"Confirm password"}),s.jsx("input",{type:"file"}),s.jsx("button",{children:"Sign Up"}),t!==""&&s.jsx("span",{className:A.error,children:"Something went wrong"})]}),s.jsxs("p",{children:["Already have an account? ",s.jsx(F,{to:"/login",children:"Log In"})]})]})},Ge="_container_1azqi_1",Ve="_error_1azqi_40",P={container:Ge,error:Ve},Ye=()=>{const[t,a]=i.useState(""),{setIsLoading:c}=i.useContext(y),l=E(),e=async n=>{n.preventDefault();const u=n.currentTarget[0].value,o=n.currentTarget[1].value;try{try{await ie(I,u,o)}catch(d){throw a(String(d)),d}c(!0),l("../",{replace:!0})}catch(d){throw a(String(d)),d}};return s.jsxs("div",{className:P.container,children:[s.jsxs("form",{onSubmit:n=>e(n),children:[s.jsx("input",{type:"email",autoComplete:"email",placeholder:"E-mail"}),s.jsx("input",{type:"password",autoComplete:"current-password",placeholder:"Password"}),s.jsx("button",{children:"Login"}),t!==""&&s.jsxs("span",{className:P.error,children:["Something went wrong ",t]})]}),s.jsxs("p",{children:["Don't have an account? ",s.jsx(F,{to:"/register",children:"Sign Up"})]})]})};function Je(){return s.jsx("div",{className:pe.container,children:s.jsxs(le,{children:[s.jsx(L,{path:"/",element:s.jsx(ke,{})}),s.jsx(L,{path:"/register",element:s.jsx(Qe,{})}),s.jsx(L,{path:"/login",element:s.jsx(Ye,{})})]})})}K.createRoot(document.getElementById("root")).render(s.jsx(H.StrictMode,{children:s.jsx(Ie,{children:s.jsx(be,{children:s.jsx(ue,{children:s.jsx(Je,{})})})})}));
