import{j as e,r as c,a as D}from"./react-BrP7bTIu.js";import{c as M}from"./react-dom-BtizlmEl.js";import{i as B,g as k,a as q,b as z,o as F,c as W,d as f,e as H,s as b,u as U,f as I,q as K,w as Q,h as G,j as Z,k as V,l as Y,m as J,n as X,p as ee,t as se,v as te}from"./@firebase-BLQkDeAT.js";import"./firebase-EUiONGWj.js";import{d as L,e as ae,f as re,g as w}from"./react-router-C0nYgrbg.js";import{N as P,H as oe}from"./react-router-dom-iW47g7mf.js";import"./scheduler-CzFDRTuY.js";import"./tslib-BGVaTf34.js";import"./idb-BXWtuYvb.js";import"./@remix-run-BgBg4VcQ.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))l(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&l(n)}).observe(document,{childList:!0,subtree:!0});function i(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function l(s){if(s.ep)return;s.ep=!0;const a=i(s);fetch(s.href,a)}})();const ne="_container_11yjs_2",ce={container:ne},ie="_container_18xfg_1",le="_topbar_18xfg_9",de="_messageWrapper_18xfg_20",S={container:ie,topbar:le,messageWrapper:de},ue="_container_tsfc4_1",pe="_time_tsfc4_13",E={container:ue,time:pe},j=({messageText:t,time:o})=>e.jsxs("div",{className:E.container,children:[e.jsx("p",{children:t}),e.jsx("span",{className:E.time,children:o})]}),me="_container_f0tss_1",he={container:me},ge=()=>e.jsx("div",{className:he.container,children:e.jsx("textarea",{})}),xe={apiKey:"AIzaSyAB80-tZTx63iK-eSokF2n1HNM25fO_rZ4",authDomain:"react-chat-app-cf377.firebaseapp.com",projectId:"react-chat-app-cf377",storageBucket:"react-chat-app-cf377.appspot.com",messagingSenderId:"333727045415",appId:"1:333727045415:web:07aac7a056b70e402bbb02"};B(xe);const v=k(),fe=q(),h=z(),_=c.createContext({currentUser:{},isLoading:!0,setIsLoading:t=>{}}),je=({children:t})=>{const[o,i]=c.useState({}),[l,s]=c.useState(!0);c.useEffect(()=>{const n=F(v,d=>{d&&i(d),s(!1)});return()=>{n()}},[o]);const a={currentUser:o,isLoading:l,setIsLoading:s};return e.jsx(_.Provider,{value:a,children:t})},R=c.createContext({}),_e=({children:t})=>{const o={chatId:"",user:{}},{currentUser:i}=c.useContext(_),l=(n,d)=>{if(d.type==="CHANGE_USER"){if(i.uid)return{user:d.payload,chatId:i.uid>d.payload.uid?i.uid+d.payload.uid:d.payload.uid+i.uid}}else return n},[s,a]=c.useReducer(l,o);return e.jsx(R.Provider,{value:{data:s,dispatch:a},children:t})},ye=()=>{const{data:t}=c.useContext(R);return e.jsxs("div",{className:S.container,children:[e.jsx("div",{className:S.topbar,children:t!=null&&t.user?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:t.user.photoURL,alt:"User photo"}),e.jsx("p",{children:t.user.displayName})]}):e.jsx("p",{children:"USER NOT FOUND"})}),e.jsxs("div",{className:S.messageWrapper,children:[e.jsx(j,{messageText:"11111 1111 1111 1111111 1 111",time:"15:40"}),e.jsx(j,{messageText:"22222222222222222222",time:"15:40"}),e.jsx(j,{messageText:"333333 3333333 3333333333 3333333 333",time:"15:40"}),e.jsx(j,{messageText:"444 44444 444 44444  44",time:"15:40"}),e.jsx(j,{messageText:"5555 5555555 5555 5555 555 5555",time:"15:40"}),e.jsx(j,{messageText:"55555555555555555555555555555555555555",time:"15:40"}),e.jsx(ge,{})]})]})},Ne="_container_t6ds5_1",ve="_wrapper_t6ds5_14",we="_username_t6ds5_20",Se="_message_t6ds5_23",x={container:Ne,wrapper:ve,username:we,message:Se},$=({chatUser:t,setSearchedUser:o,isSearched:i,setUserQuery:l})=>{const{currentUser:s}=c.useContext(_),{dispatch:a}=c.useContext(R),[n,d]=c.useState({});c.useEffect(()=>{if(s!=null&&s.uid){const r=W(f(h,"userChats",s.uid),p=>{const y=p.data();y!==void 0&&d(y)});return()=>{r()}}},[s.uid]);const u=async()=>{if(s.uid!==""&&s.uid!==void 0){const r=s.uid>t.uid?s.uid+t.uid:t.uid+s.uid;try{const p=await H(f(h,"chats",r));p.exists()||(await b(f(h,"chats",r),{messages:[]}),await U(f(h,"userChats",s.uid),{[r+".userInfo"]:{uid:t.uid,displayName:t.displayName,photoURL:t.photoURL},[r+".date"]:I()}),await U(f(h,"userChats",t.uid),{[r+".userInfo"]:{uid:s.uid,displayName:s.displayName,photoURL:s.photoURL},[r+".date"]:I()})),i&&(o({displayName:"",photoURL:"",lastMessage:"",uid:""}),l("")),console.log(p)}catch(p){console.log(p)}}console.log(s.uid+t.uid)},g=r=>{a({type:"CHANGE_USER",payload:r})};return e.jsx(e.Fragment,{children:i?e.jsxs("div",{onClick:()=>{u(),g(t)},className:x.container,children:[e.jsx("img",{src:t.photoURL}),e.jsx("div",{className:x.wrapper,children:e.jsx("p",{className:x.username,children:t.displayName})})]}):e.jsx(e.Fragment,{children:Object.entries(n).map(r=>e.jsxs("div",{className:x.container,onClick:()=>g(r[1].userInfo),children:[e.jsx("img",{src:r[1].userInfo.photoURL}),e.jsxs("div",{className:x.wrapper,children:[e.jsx("p",{className:x.username,children:r[1].userInfo.displayName}),e.jsx("p",{className:x.message,children:r[1].userInfo.lastMessage})]})]},r[0]))})})},Ce="_container_17q7h_1",be={container:Ce},Le=({setSearchedUser:t,userQuery:o,setUserQuery:i})=>{const[l,s]=c.useState(""),a=async n=>{const d=K(G(h,"users"),Q("email","==",n));try{const u=await Z(d);console.log(u.docs.length),u.docs.length>0?u.forEach(g=>{const r=g.data();console.log(r),t({displayName:r.displayName,photoURL:r.photoURL,lastMessage:"???",uid:r.uid})}):t({displayName:"",photoURL:"",lastMessage:"",uid:""})}catch(u){s(String(u)),console.log(u)}};return e.jsxs("div",{className:be.container,children:[e.jsx("input",{type:"text",placeholder:"Search email",onChange:n=>{i(n.target.value),a(n.target.value)},value:o}),l!==""&&e.jsx("p",{children:l})]})},Re="_container_1tkgu_1",Ue="_navbar_1tkgu_5",Ie="_logoutBtn_1tkgu_12",C={container:Re,navbar:Ue,logoutBtn:Ie},Ee=()=>{const t=L(),{currentUser:o}=c.useContext(_),[i,l]=c.useState({displayName:"",photoURL:"",uid:"",lastMessage:""}),[s,a]=c.useState(""),[n]=c.useState({displayName:"Temp User",photoURL:"https://source.unsplash.com/random",lastMessage:"Last message text",uid:"qwertyuioQWERTYUIO"});return e.jsxs("div",{className:C.container,children:[e.jsxs("div",{className:C.navbar,children:[e.jsx("img",{src:o==null?void 0:o.photoURL,alt:o.displayName}),e.jsx("span",{children:o.displayName}),e.jsx("button",{className:C.logoutBtn,onClick:()=>{V(v).then(()=>{t("../login",{replace:!0})}).catch(d=>{console.log(d)})},children:"Logout"})]}),e.jsx(Le,{setSearchedUser:l,userQuery:s,setUserQuery:a}),i.displayName!==""&&e.jsx($,{chatUser:i,setSearchedUser:l,isSearched:!0,setUserQuery:a}),e.jsx($,{chatUser:n})]})},$e="_container_6zf3o_1",Te="_wrapper_6zf3o_5",Ae="_loadingScreen_6zf3o_9",Pe="_loader_6zf3o_18",Oe="_rotation_6zf3o_1",N={container:$e,wrapper:Te,loadingScreen:Ae,loader:Pe,rotation:Oe},De=()=>{const{currentUser:t,isLoading:o}=c.useContext(_);return o?e.jsx("div",{className:N.loadingScreen,children:e.jsx("span",{className:N.loader})}):"email"in t?e.jsx("div",{className:N.container,children:e.jsxs("div",{className:N.wrapper,children:[e.jsx(Ee,{}),e.jsx(ye,{})]})}):e.jsx(ae,{to:{pathname:"/login"}})},Me="_container_pscem_1",Be="_error_pscem_40",T={container:Me,error:Be},ke=()=>{const[t,o]=c.useState(""),i=L(),l=s=>{s.preventDefault();const a=s.currentTarget[0].value,n=s.currentTarget[1].value,d=s.currentTarget[2].value,u=s.currentTarget[4],g=u.files?u.files[0]:null;console.log(a);try{const r=Y(v,n,d),p=J(fe,a);if(g){const y=X(p,g);y.on("state_changed",m=>{const O=m.bytesTransferred/m.totalBytes*100;switch(console.log("Upload is "+O+"% done"),m.state){case"paused":console.log("Upload is paused");break;case"running":console.log("Upload is running");break}},m=>{o(String(m))},()=>{ee(y.snapshot.ref).then(async m=>{await se((await r).user,{displayName:a,photoURL:m}),await b(f(h,"users",(await r).user.uid),{uid:(await r).user.uid,displayName:a,email:n,photoURL:m}),await b(f(h,"userChats",(await r).user.uid),{})}),i("../",{replace:!0})})}}catch(r){o(String(r)),console.log(r)}};return e.jsxs("div",{className:T.container,children:[e.jsxs("form",{onSubmit:s=>l(s),children:[e.jsx("input",{type:"text",autoComplete:"username",placeholder:"Username"}),e.jsx("input",{type:"email",autoComplete:"email",placeholder:"E-mail"}),e.jsx("input",{type:"password",autoComplete:"new-password",placeholder:"Password"}),e.jsx("input",{type:"password",autoComplete:"new-password",placeholder:"Confirm password"}),e.jsx("input",{type:"file"}),e.jsx("button",{children:"Sign Up"}),t!==""&&e.jsx("span",{className:T.error,children:"Something went wrong"})]}),e.jsxs("p",{children:["Already have an account? ",e.jsx(P,{to:"/login",children:"Log In"})]})]})},qe="_container_1j0f6_1",ze="_error_1j0f6_40",A={container:qe,error:ze},Fe=()=>{const[t,o]=c.useState(""),{setIsLoading:i}=c.useContext(_),l=L(),s=async a=>{a.preventDefault();const n=a.currentTarget[0].value,d=a.currentTarget[1].value;try{try{await te(v,n,d)}catch(u){throw o(String(u)),u}i(!0),l("../",{replace:!0})}catch(u){throw o(String(u)),u}};return e.jsxs("div",{className:A.container,children:[e.jsxs("form",{onSubmit:a=>s(a),children:[e.jsx("input",{type:"email",autoComplete:"email",placeholder:"E-mail"}),e.jsx("input",{type:"password",autoComplete:"current-password",placeholder:"Password"}),e.jsx("button",{children:"Login"}),t!==""&&e.jsxs("span",{className:A.error,children:["Something went wrong ",t]})]}),e.jsxs("p",{children:["Don't have an account? ",e.jsx(P,{to:"/register",children:"Sign Up"})]})]})};function We(){return e.jsx("div",{className:ce.container,children:e.jsxs(re,{children:[e.jsx(w,{path:"/",element:e.jsx(De,{})}),e.jsx(w,{path:"/register",element:e.jsx(ke,{})}),e.jsx(w,{path:"/login",element:e.jsx(Fe,{})})]})})}M.createRoot(document.getElementById("root")).render(e.jsx(D.StrictMode,{children:e.jsx(je,{children:e.jsx(_e,{children:e.jsx(oe,{children:e.jsx(We,{})})})})}));
