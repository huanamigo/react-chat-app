import{r as l,j as s,a as H}from"./react-BrP7bTIu.js";import{c as K}from"./react-dom-BtizlmEl.js";import{i as Q,g as G,a as V,b as Y,o as J,c as P,u as D,d as F,e as _,f as E,T as q,h as m,s as w,j as W,k as X,l as T,q as ee,w as se,m as te,n as ne,p as ae,t as oe,v as re,x as ie}from"./@firebase-C2FYEwhL.js";import"./firebase-C9-PzAQB.js";import{v as L}from"./uuid-D8aEg3BZ.js";import{d as $,e as ce,f as le,g as U}from"./react-router-C0nYgrbg.js";import{N as z,H as de}from"./react-router-dom-iW47g7mf.js";import"./scheduler-CzFDRTuY.js";import"./tslib-BGVaTf34.js";import"./idb-BXWtuYvb.js";import"./@remix-run-BgBg4VcQ.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))o(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const d of n.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function i(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function o(e){if(e.ep)return;e.ep=!0;const n=i(e);fetch(e.href,n)}})();const ue="_container_11yjs_2",pe={container:ue},he="_container_ht8ob_1",ge="_topbar_ht8ob_9",me="_messageWrapper_ht8ob_25",R={container:he,topbar:ge,messageWrapper:me},xe="_ownMessage_a2fyp_1",fe="_notMyMessage_a2fyp_8",je="_container_a2fyp_15",_e="_time_a2fyp_23",v={ownMessage:xe,notMyMessage:fe,container:je,time:_e},ye={apiKey:"AIzaSyAB80-tZTx63iK-eSokF2n1HNM25fO_rZ4",authDomain:"react-chat-app-cf377.firebaseapp.com",projectId:"react-chat-app-cf377",storageBucket:"react-chat-app-cf377.appspot.com",messagingSenderId:"333727045415",appId:"1:333727045415:web:07aac7a056b70e402bbb02"};Q(ye);const b=G(),Z=V(),h=Y(),y=l.createContext({currentUser:{},isLoading:!0,setIsLoading:t=>{}}),ve=({children:t})=>{const[a,i]=l.useState({}),[o,e]=l.useState(!0);l.useEffect(()=>{const d=J(b,c=>{c&&i(c),e(!1)});return()=>{d()}},[a]);const n={currentUser:a,isLoading:o,setIsLoading:e};return s.jsx(y.Provider,{value:n,children:t})},we=({messageText:t,time:a,senderId:i})=>{const{currentUser:o}=l.useContext(y);return s.jsx(s.Fragment,{children:o.uid===i?s.jsxs("div",{className:`${v.ownMessage} ${v.container}`,children:[s.jsx("span",{className:v.time,children:a}),s.jsx("p",{children:t})]}):s.jsxs("div",{className:`${v.container} ${v.notMyMessage}`,children:[s.jsx("p",{children:t}),s.jsx("span",{className:v.time,children:a})]})})},Ne="_container_7zog1_1",Se="_inputWrapper_7zog1_11",Ie="_fileInputLabel_7zog1_27",be="_textInput_7zog1_35",Ce="_sendBtn_7zog1_41",N={container:Ne,inputWrapper:Se,fileInputLabel:Ie,textInput:be,sendBtn:Ce},C=l.createContext({}),Le=({children:t})=>{const a={chatId:"",user:{}},{currentUser:i}=l.useContext(y),o=(d,c)=>{if(c.type==="CHANGE_USER"){if(console.log(c.payload),i.uid)return{user:c.payload,chatId:i.uid>c.payload.uid?i.uid+c.payload.uid:c.payload.uid+i.uid}}else return d},[e,n]=l.useReducer(o,a);return s.jsx(C.Provider,{value:{data:e,dispatch:n},children:t})},Ue=()=>{const[t,a]=l.useState(""),[i,o]=l.useState(),{data:e}=l.useContext(C),{currentUser:n}=l.useContext(y),d=async c=>{var u,f,r,x;if(c.preventDefault(),t!=="")if(console.log(i),i){const j=P(Z,L()),p=D(j,i);p.on("state_changed",g=>{const k=g.bytesTransferred/g.totalBytes*100;switch(console.log("Upload is "+k+"% done"),g.state){case"paused":console.log("Upload is paused");break;case"running":console.log("Upload is running");break}},g=>{console.log(String(g))},()=>{F(p.snapshot.ref).then(async g=>{e!=null&&e.chatId&&await _(m(h,"chats",e==null?void 0:e.chatId),{messages:E({id:L(),text:t,senderId:n.uid,date:q.now(),img:g})})})}),n.uid&&await _(m(h,"userChats",n.uid),{[(e==null?void 0:e.chatId)+".lastMessage"]:{text:t},[(e==null?void 0:e.chatId)+".date"]:w()}),e&&((u=e.user)!=null&&u.uid)&&await _(m(h,"userChats",(f=e.user)==null?void 0:f.uid),{[(e==null?void 0:e.chatId)+".lastMessage"]:{text:t},[(e==null?void 0:e.chatId)+".date"]:w()}),o(void 0),a(""),console.log(t)}else console.log(e==null?void 0:e.chatId),e!=null&&e.chatId&&await _(m(h,"chats",e==null?void 0:e.chatId),{messages:E({id:L(),text:t,senderId:n.uid,date:q.now()})}),n.uid&&await _(m(h,"userChats",n.uid),{[(e==null?void 0:e.chatId)+".lastMessage"]:{text:t},[(e==null?void 0:e.chatId)+".date"]:w()}),e&&((r=e.user)!=null&&r.uid)&&await _(m(h,"userChats",(x=e.user)==null?void 0:x.uid),{[(e==null?void 0:e.chatId)+".lastMessage"]:{text:t},[(e==null?void 0:e.chatId)+".date"]:w()}),a("")};return s.jsx("div",{className:N.container,children:s.jsxs("form",{onSubmit:c=>d(c),children:[s.jsxs("div",{className:N.inputWrapper,children:[s.jsx("label",{htmlFor:"fileInput",className:N.fileInputLabel,children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#fff",children:s.jsx("path",{d:"M640-520v-200h80v200h-80ZM440-244q-35-10-57.5-39T360-350v-370h80v476Zm30 164q-104 0-177-73t-73-177v-370q0-75 52.5-127.5T400-880q75 0 127.5 52.5T580-700v300h-80v-300q-1-42-29.5-71T400-800q-42 0-71 29t-29 71v370q-1 71 49 120.5T470-160q25 0 47.5-6.5T560-186v89q-21 8-43.5 12.5T470-80Zm170-40v-120H520v-80h120v-120h80v120h120v80H720v120h-80Z"})})}),s.jsx("input",{className:N.textInput,value:t,onChange:c=>a(c.target.value)}),s.jsx("input",{type:"file",id:"fileInput",onChange:c=>{c.target.files&&o(c.target.files[0])}})]}),s.jsx("button",{className:N.sendBtn,type:"submit",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#fff",children:s.jsx("path",{d:"M120-160v-640l760 320-760 320Zm80-120 474-200-474-200v140l240 60-240 60v140Zm0 0v-400 400Z"})})})]})})},Re=()=>{const{data:t}=l.useContext(C),[a,i]=l.useState([]);return l.useEffect(()=>{if(t!=null&&t.chatId){const o=W(m(h,"chats",t.chatId),e=>{e.exists()&&i(e.data().messages),console.log(e.data())});return()=>{o()}}},[t==null?void 0:t.chatId]),s.jsx("div",{className:R.container,children:(t==null?void 0:t.chatId)!==""?s.jsxs(s.Fragment,{children:[s.jsx("div",{className:R.topbar,children:t!=null&&t.user?s.jsxs(s.Fragment,{children:[s.jsx("img",{src:t.user.photoURL,alt:"User photo"}),s.jsx("p",{children:t.user.displayName})]}):s.jsx("p",{children:"USER NOT FOUND"})}),s.jsxs("div",{className:R.messageWrapper,children:[a.length>0&&a.map(o=>s.jsx(we,{messageText:o.text,senderId:o.senderId,time:"21:15"},o.id)),s.jsx(Ue,{})]})]}):null})},Me="_container_1rhxh_1",Te="_wrapper_1rhxh_15",$e="_username_1rhxh_21",Ee="_message_1rhxh_24",S={container:Me,wrapper:Te,username:$e,message:Ee},B=({chatUser:t,setSearchedUser:a,isSearched:i,setUserQuery:o})=>{const{currentUser:e}=l.useContext(y),{dispatch:n}=l.useContext(C),[d,c]=l.useState({});l.useEffect(()=>{if(e!=null&&e.uid){const r=W(m(h,"userChats",e.uid),x=>{const j=x.data();j!==void 0&&(c(Object.entries(j).sort((p,g)=>g[1].date!==null&&p[1].date!==null?g[1].date.seconds-p[1].date.seconds:g[1].date!==null?g[1].date.seconds:p[1].date.seconds)),console.log(Object.entries(j)))});return()=>{r()}}},[e.uid]);const u=async()=>{if(e.uid!==""&&e.uid!==void 0){const r=e.uid>t.uid?e.uid+t.uid:t.uid+e.uid;try{const x=await X(m(h,"chats",r));x.exists()||(await T(m(h,"chats",r),{messages:[]}),await _(m(h,"userChats",e.uid),{[r+".userInfo"]:{uid:t.uid,displayName:t.displayName,photoURL:t.photoURL},[r+".date"]:w()}),await _(m(h,"userChats",t.uid),{[r+".userInfo"]:{uid:e.uid,displayName:e.displayName,photoURL:e.photoURL},[r+".date"]:w()})),i&&(a({displayName:"",photoURL:"",lastMessage:"",uid:""}),o("")),console.log(x)}catch(x){console.log(x)}}console.log(e.uid+t.uid)},f=r=>{n({type:"CHANGE_USER",payload:r})};return s.jsx(s.Fragment,{children:i?s.jsxs("div",{onClick:()=>{u(),f(t)},className:S.container,children:[s.jsx("img",{src:t.photoURL}),s.jsx("div",{className:S.wrapper,children:s.jsx("p",{className:S.username,children:t.displayName})})]}):s.jsx(s.Fragment,{children:Object.entries(d).map(r=>s.jsx("div",{className:S.container,onClick:()=>{console.log(r)}},r[0]))})})},qe="_container_17q7h_1",Be={container:qe},Ae=({setSearchedUser:t,userQuery:a,setUserQuery:i})=>{const[o,e]=l.useState(""),n=async d=>{const c=ee(te(h,"users"),se("email","==",d));try{const u=await ne(c);console.log(u.docs.length),u.docs.length>0?u.forEach(f=>{const r=f.data();console.log(r),t({displayName:r.displayName,photoURL:r.photoURL,lastMessage:"???",uid:r.uid})}):t({displayName:"",photoURL:"",lastMessage:"",uid:""})}catch(u){e(String(u)),console.log(u)}};return s.jsxs("div",{className:Be.container,children:[s.jsx("input",{type:"text",placeholder:"Search email",onChange:d=>{i(d.target.value),n(d.target.value)},value:a}),o!==""&&s.jsx("p",{children:o})]})},Oe="_container_8th3l_1",Pe="_navbar_8th3l_5",De="_logoutBtn_8th3l_12",M={container:Oe,navbar:Pe,logoutBtn:De},Fe=()=>{const t=$(),{currentUser:a}=l.useContext(y),[i,o]=l.useState({displayName:"",photoURL:"",uid:"",lastMessage:""}),[e,n]=l.useState(""),[d]=l.useState({displayName:"Temp User",photoURL:"https://source.unsplash.com/random",lastMessage:"Last message text",uid:"qwertyuioQWERTYUIO"});return s.jsxs("div",{className:M.container,children:[s.jsxs("div",{className:M.navbar,children:[s.jsx("img",{src:a==null?void 0:a.photoURL,alt:a.displayName}),s.jsx("span",{children:a.displayName}),s.jsx("button",{className:M.logoutBtn,onClick:()=>{ae(b).then(()=>{t("../login",{replace:!0})}).catch(c=>{console.log(c)})},children:"Logout"})]}),s.jsx(Ae,{setSearchedUser:o,userQuery:e,setUserQuery:n}),i.displayName!==""&&s.jsx(B,{chatUser:i,setSearchedUser:o,isSearched:!0,setUserQuery:n}),s.jsx(B,{chatUser:d})]})},We="_container_1whll_1",ze="_wrapper_1whll_5",Ze="_loadingScreen_1whll_9",ke="_loader_1whll_18",He="_rotation_1whll_1",I={container:We,wrapper:ze,loadingScreen:Ze,loader:ke,rotation:He},Ke=()=>{const{currentUser:t,isLoading:a}=l.useContext(y);return a?s.jsx("div",{className:I.loadingScreen,children:s.jsx("span",{className:I.loader})}):"email"in t?s.jsx("div",{className:I.container,children:s.jsxs("div",{className:I.wrapper,children:[s.jsx(Fe,{}),s.jsx(Re,{})]})}):s.jsx(ce,{to:{pathname:"/login"}})},Qe="_container_1y4t8_1",Ge="_error_1y4t8_40",A={container:Qe,error:Ge},Ve=()=>{const[t,a]=l.useState(""),i=$(),o=e=>{e.preventDefault();const n=e.currentTarget[0].value,d=e.currentTarget[1].value,c=e.currentTarget[2].value,u=e.currentTarget[4],f=u.files?u.files[0]:null;console.log(n);try{const r=oe(b,d,c),x=P(Z,n);if(f){const j=D(x,f);j.on("state_changed",p=>{const g=p.bytesTransferred/p.totalBytes*100;switch(console.log("Upload is "+g+"% done"),p.state){case"paused":console.log("Upload is paused");break;case"running":console.log("Upload is running");break}},p=>{a(String(p))},()=>{F(j.snapshot.ref).then(async p=>{await re((await r).user,{displayName:n,photoURL:p}),await T(m(h,"users",(await r).user.uid),{uid:(await r).user.uid,displayName:n,email:d,photoURL:p}),await T(m(h,"userChats",(await r).user.uid),{})}),i("../",{replace:!0})})}}catch(r){a(String(r)),console.log(r)}};return s.jsxs("div",{className:A.container,children:[s.jsxs("form",{onSubmit:e=>o(e),children:[s.jsx("input",{type:"text",autoComplete:"username",placeholder:"Username"}),s.jsx("input",{type:"email",autoComplete:"email",placeholder:"E-mail"}),s.jsx("input",{type:"password",autoComplete:"new-password",placeholder:"Password"}),s.jsx("input",{type:"password",autoComplete:"new-password",placeholder:"Confirm password"}),s.jsx("input",{type:"file"}),s.jsx("button",{children:"Sign Up"}),t!==""&&s.jsx("span",{className:A.error,children:"Something went wrong"})]}),s.jsxs("p",{children:["Already have an account? ",s.jsx(z,{to:"/login",children:"Log In"})]})]})},Ye="_container_1azqi_1",Je="_error_1azqi_40",O={container:Ye,error:Je},Xe=()=>{const[t,a]=l.useState(""),{setIsLoading:i}=l.useContext(y),o=$(),e=async n=>{n.preventDefault();const d=n.currentTarget[0].value,c=n.currentTarget[1].value;try{try{await ie(b,d,c)}catch(u){throw a(String(u)),u}i(!0),o("../",{replace:!0})}catch(u){throw a(String(u)),u}};return s.jsxs("div",{className:O.container,children:[s.jsxs("form",{onSubmit:n=>e(n),children:[s.jsx("input",{type:"email",autoComplete:"email",placeholder:"E-mail"}),s.jsx("input",{type:"password",autoComplete:"current-password",placeholder:"Password"}),s.jsx("button",{children:"Login"}),t!==""&&s.jsxs("span",{className:O.error,children:["Something went wrong ",t]})]}),s.jsxs("p",{children:["Don't have an account? ",s.jsx(z,{to:"/register",children:"Sign Up"})]})]})};function es(){return s.jsx("div",{className:pe.container,children:s.jsxs(le,{children:[s.jsx(U,{path:"/",element:s.jsx(Ke,{})}),s.jsx(U,{path:"/register",element:s.jsx(Ve,{})}),s.jsx(U,{path:"/login",element:s.jsx(Xe,{})})]})})}K.createRoot(document.getElementById("root")).render(s.jsx(H.StrictMode,{children:s.jsx(ve,{children:s.jsx(Le,{children:s.jsx(de,{children:s.jsx(es,{})})})})}));
