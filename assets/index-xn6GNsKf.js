import{j as e,r as i,a as M}from"./react-BrP7bTIu.js";import{c as O}from"./react-dom-BtizlmEl.js";import{i as P,g as D,a as B,b as z,o as q,c as F,d as x,e as W,s as N,u as C,f as L,q as k,w as H,h as K,j as Q,k as Y,l as Z,m as V,n as G,p as J,t as X,v as ee}from"./@firebase-BLQkDeAT.js";import"./firebase-EUiONGWj.js";import{d as S,e as se,f as te,g as w}from"./react-router-C0nYgrbg.js";import{N as E,H as ae}from"./react-router-dom-iW47g7mf.js";import"./scheduler-CzFDRTuY.js";import"./tslib-BGVaTf34.js";import"./idb-BXWtuYvb.js";import"./@remix-run-BgBg4VcQ.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))c(s);new MutationObserver(s=>{for(const t of s)if(t.type==="childList")for(const o of t.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&c(o)}).observe(document,{childList:!0,subtree:!0});function l(s){const t={};return s.integrity&&(t.integrity=s.integrity),s.referrerPolicy&&(t.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?t.credentials="include":s.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function c(s){if(s.ep)return;s.ep=!0;const t=l(s);fetch(s.href,t)}})();const ne="_container_11yjs_2",re={container:ne},oe="_container_1e56t_1",ce={container:oe},ie="_container_tsfc4_1",le="_time_tsfc4_13",I={container:ie,time:le},f=({messageText:a,time:r})=>e.jsxs("div",{className:I.container,children:[e.jsx("p",{children:a}),e.jsx("span",{className:I.time,children:r})]}),ue="_container_f0tss_1",de={container:ue},pe=()=>e.jsx("div",{className:de.container,children:e.jsx("textarea",{})}),me=()=>e.jsxs("div",{className:ce.container,children:[e.jsx(f,{messageText:"11111 1111 1111 1111111 1 111",time:"15:40"}),e.jsx(f,{messageText:"22222222222222222222",time:"15:40"}),e.jsx(f,{messageText:"333333 3333333 3333333333 3333333 333",time:"15:40"}),e.jsx(f,{messageText:"444 44444 444 44444  44",time:"15:40"}),e.jsx(f,{messageText:"5555 5555555 5555 5555 555 5555",time:"15:40"}),e.jsx(f,{messageText:"55555555555555555555555555555555555555",time:"15:40"}),e.jsx(pe,{})]}),ge="_container_t6ds5_1",he="_wrapper_t6ds5_14",xe="_username_t6ds5_20",fe="_message_t6ds5_23",h={container:ge,wrapper:he,username:xe,message:fe},je={apiKey:"AIzaSyAB80-tZTx63iK-eSokF2n1HNM25fO_rZ4",authDomain:"react-chat-app-cf377.firebaseapp.com",projectId:"react-chat-app-cf377",storageBucket:"react-chat-app-cf377.appspot.com",messagingSenderId:"333727045415",appId:"1:333727045415:web:07aac7a056b70e402bbb02"};P(je);const y=D(),_e=B(),g=z(),j=i.createContext({currentUser:{},isLoading:!0,setIsLoading:a=>{}}),ye=({children:a})=>{const[r,l]=i.useState({}),[c,s]=i.useState(!0);i.useEffect(()=>{const o=q(y,d=>{d&&l(d),s(!1)});return()=>{o()}},[r]);const t={currentUser:r,isLoading:c,setIsLoading:s};return e.jsx(j.Provider,{value:t,children:a})},$=({chatUser:a,setSearchedUser:r,isSearched:l,setUserQuery:c})=>{const{currentUser:s}=i.useContext(j),[t,o]=i.useState({});i.useEffect(()=>{if(s!=null&&s.uid){const n=F(x(g,"userChats",s.uid),p=>{const u=p.data();u!==void 0&&o(u)});return()=>{n()}}},[s.uid]);const d=async()=>{if(s.uid!==""&&s.uid!==void 0){const n=s.uid>a.uid?s.uid+a.uid:a.uid+s.uid;try{const p=await W(x(g,"chats",n));p.exists()||(await N(x(g,"chats",n),{messages:[]}),await C(x(g,"userChats",s.uid),{[n+".userInfo"]:{uid:a.uid,displayName:a.username,photoURL:a.img},[n+".date"]:L()}),await C(x(g,"userChats",a.uid),{[n+".userInfo"]:{uid:s.uid,displayName:s.displayName,photoURL:s.photoURL},[n+".date"]:L()})),l&&(r({username:"",img:"",lastMessage:"",uid:""}),c("")),console.log(p)}catch(p){console.log(p)}}console.log(s.uid+a.uid)};return e.jsx(e.Fragment,{children:l?e.jsxs("div",{onClick:()=>d(),className:h.container,children:[e.jsx("img",{src:a.img}),e.jsx("div",{className:h.wrapper,children:e.jsx("p",{className:h.username,children:a.username})})]}):e.jsx(e.Fragment,{children:Object.entries(t).map(n=>e.jsxs("div",{className:h.container,children:[e.jsx("img",{src:n[1].userInfo.photoURL}),e.jsxs("div",{className:h.wrapper,children:[e.jsx("p",{className:h.username,children:n[1].userInfo.displayName}),e.jsx("p",{className:h.message,children:n[1].userInfo.lastMessage})]})]},n[0]))})})},we="_container_17q7h_1",ve={container:we},Ne=({setSearchedUser:a,userQuery:r,setUserQuery:l})=>{const[c,s]=i.useState(""),t=async o=>{const d=k(K(g,"users"),H("email","==",o));try{const n=await Q(d);console.log(n.docs.length),n.docs.length>0?n.forEach(p=>{const u=p.data();console.log(u),a({username:u.displayName,img:u.photoURL,lastMessage:"???",uid:u.uid})}):a({username:"",img:"",lastMessage:"",uid:""})}catch(n){s(String(n)),console.log(n)}};return e.jsxs("div",{className:ve.container,children:[e.jsx("input",{type:"text",placeholder:"Search email",onChange:o=>{l(o.target.value),t(o.target.value)},value:r}),c!==""&&e.jsx("p",{children:c})]})},Se="_container_1otf5_1",be="_navbar_1otf5_5",Ce="_logoutBtn_1otf5_11",v={container:Se,navbar:be,logoutBtn:Ce},Le=()=>{const a=S(),{currentUser:r}=i.useContext(j),[l,c]=i.useState({username:"",img:"",lastMessage:"",uid:""}),[s,t]=i.useState(""),[o]=i.useState({username:"temp",img:"https://source.unsplash.com/random",lastMessage:"jazda",uid:"qwertyuioQWERTYUIO"});return e.jsxs("div",{className:v.container,children:[e.jsxs("div",{className:v.navbar,children:[e.jsx("img",{src:r==null?void 0:r.photoURL,alt:r.displayName}),e.jsx("span",{children:r.displayName}),e.jsx("button",{className:v.logoutBtn,onClick:()=>{Y(y).then(()=>{console.log("WYLogoWANO"),a("../login",{replace:!0})}).catch(d=>{console.log(d)})},children:"Logout"})]}),e.jsx(Ne,{setSearchedUser:c,userQuery:s,setUserQuery:t}),l.username!==""&&e.jsx($,{chatUser:l,setSearchedUser:c,isSearched:!0,setUserQuery:t}),e.jsx($,{chatUser:o})]})},Ie="_container_6zf3o_1",$e="_wrapper_6zf3o_5",Re="_loadingScreen_6zf3o_9",Te="_loader_6zf3o_18",Ee="_rotation_6zf3o_1",_={container:Ie,wrapper:$e,loadingScreen:Re,loader:Te,rotation:Ee},Ue=()=>{const{currentUser:a,isLoading:r}=i.useContext(j);return console.log(a),console.log(r),r?e.jsx("div",{className:_.loadingScreen,children:e.jsx("span",{className:_.loader})}):"email"in a?e.jsx("div",{className:_.container,children:e.jsxs("div",{className:_.wrapper,children:[e.jsx(Le,{}),e.jsx(me,{})]})}):e.jsx(se,{to:{pathname:"/login"}})},Ae="_container_pscem_1",Me="_error_pscem_40",R={container:Ae,error:Me},Oe=()=>{const[a,r]=i.useState(""),l=S(),c=s=>{s.preventDefault();const t=s.currentTarget[0].value,o=s.currentTarget[1].value,d=s.currentTarget[2].value,n=s.currentTarget[4],p=n.files?n.files[0]:null;console.log(t);try{const u=Z(y,o,d),U=V(_e,t);if(p){const b=G(U,p);b.on("state_changed",m=>{const A=m.bytesTransferred/m.totalBytes*100;switch(console.log("Upload is "+A+"% done"),m.state){case"paused":console.log("Upload is paused");break;case"running":console.log("Upload is running");break}},m=>{r(String(m))},()=>{J(b.snapshot.ref).then(async m=>{await X((await u).user,{displayName:t,photoURL:m}),await N(x(g,"users",(await u).user.uid),{uid:(await u).user.uid,displayName:t,email:o,photoURL:m}),await N(x(g,"userChats",(await u).user.uid),{})}),l("../",{replace:!0})})}}catch(u){r(String(u)),console.log(u)}};return e.jsxs("div",{className:R.container,children:[e.jsxs("form",{onSubmit:s=>c(s),children:[e.jsx("input",{type:"text",autoComplete:"username",placeholder:"Username"}),e.jsx("input",{type:"email",autoComplete:"email",placeholder:"E-mail"}),e.jsx("input",{type:"password",autoComplete:"new-password",placeholder:"Password"}),e.jsx("input",{type:"password",autoComplete:"new-password",placeholder:"Confirm password"}),e.jsx("input",{type:"file"}),e.jsx("button",{children:"Sign Up"}),a!==""&&e.jsx("span",{className:R.error,children:"Something went wrong"})]}),e.jsxs("p",{children:["Already have an account? ",e.jsx(E,{to:"/login",children:"Log In"})]})]})},Pe="_container_1j0f6_1",De="_error_1j0f6_40",T={container:Pe,error:De},Be=()=>{const[a,r]=i.useState(""),{setIsLoading:l}=i.useContext(j),c=S(),s=async t=>{t.preventDefault();const o=t.currentTarget[0].value,d=t.currentTarget[1].value;try{try{await ee(y,o,d)}catch(n){throw r(String(n)),n}l(!0),c("../",{replace:!0})}catch(n){throw r(String(n)),n}};return e.jsxs("div",{className:T.container,children:[e.jsxs("form",{onSubmit:t=>s(t),children:[e.jsx("input",{type:"email",autoComplete:"email",placeholder:"E-mail"}),e.jsx("input",{type:"password",autoComplete:"current-password",placeholder:"Password"}),e.jsx("button",{children:"Login"}),a!==""&&e.jsxs("span",{className:T.error,children:["Something went wrong ",a]})]}),e.jsxs("p",{children:["Don't have an account? ",e.jsx(E,{to:"/register",children:"Sign Up"})]})]})};function ze(){return e.jsx("div",{className:re.container,children:e.jsxs(te,{children:[e.jsx(w,{path:"/",element:e.jsx(Ue,{})}),e.jsx(w,{path:"/register",element:e.jsx(Oe,{})}),e.jsx(w,{path:"/login",element:e.jsx(Be,{})})]})})}O.createRoot(document.getElementById("root")).render(e.jsx(M.StrictMode,{children:e.jsx(ye,{children:e.jsx(ae,{children:e.jsx(ze,{})})})}));
